<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>激光打标项目</h1>

<h2>1.项目需求</h2>

<p>​ 本项目主要通过视觉定位引导激光对工件相应位置进行字符打标。</p>

<h2>2.方案分析</h2>

<p>​ 项目主要分为相机标定与关联标定、定位引导、结果复检三个部分，各部分内容如下：</p>

<h3>2.1 相机标定与关联标定</h3>

<h4>2.1.1 相机标定</h4>

<p>​ 相机标定目的是确定相机像素当量、畸变参数等，可实现像素坐标到物理坐标的转换。</p>

<h4>2.1.2 与激光振镜坐标系关联</h4>

<p>​ 由于激光振镜坐标系是二维坐标系，与相机坐标系相同，所以关联标定即是确定二维相机图像坐标系（下图绿色坐标系）到二维打标平面坐标系（下图黑色坐标系）之间的转换矩阵。</p>

<p><img src="media\Laser_2_1.png" alt="Laser_2_1" /></p>

<p>​ 坐标系间变换关系如下：</p>

<p><img src="media/Laser_2_4.png" alt="" /></p>

<p>​ 其中<strong>(x,y)</strong>为激光振镜坐标系下坐标，<strong>(u,v)</strong>为相机坐标系下坐标，<strong>α</strong>为坐标系间缩放比例，<strong>θ</strong>为坐标系间旋转角度，<strong>(Tx,Ty)</strong>为坐标系间原点间距。所谓标定即是确定<strong>α</strong>、<strong>θ</strong>以及<strong>(Tx,Ty)</strong>的值。</p>

<h3>2.2 定位引导</h3>

<p>​ 定位引导即是通过视觉处理获取目标在图像中的位姿坐标（位置与角度），然后根据关联标定结果将其转换为机构坐标，使其可以进行相应的移动。</p>

<p>​ 下图为待激光打标工件在治具上的位置示意图，圆（绿色）周围白色区域即为字符区。在打标时只要告诉激光振镜工件的中心位置及打标起始位即可，所需的图像信息即为工件圆心坐标（蓝色）及工件在治具上位置角度<strong>θ</strong>（本项目为上下治具边缘的直线角度的平均数）即可。同时在视觉引导时需要确定工件在治具上位置是否合理，即<strong>dx</strong>与<strong>dy</strong>值处于一定范围内，在超限时认为工件装夹存在问题，此时反馈<strong>NG</strong>信号，使机构重新装夹或抛料。</p>

<p><img src="media\Laser_2_2.png" alt="Laser_2_2" /></p>

<p>根据上述分析，确定定位引导流程如下：</p>

<p><img src="media/Laser_2_5.png" alt="" /></p>

<h3>2.3 结果复检</h3>

<p>​ 结果复检的目的在于检测激光打标字符的位置是否合理，由于激光打标的字符实际是按照圆周分布，如图下图所示，所以其结果复检可按照该圆周的位置和大小进行量化。</p>

<p><img src="media\Laser_2_3.png" alt="Laser_2_3" /></p>

<p>​ 按照量化分析，结果复检流程如下：</p>

<p><img src="media/Laser_2_6.png" alt="" /></p>

<h2>3.方案实现</h2>

<h3>3.1 相机标定与关联标定</h3>

<h4>3.1.1 相机标定</h4>

<p>​ 使用“靶标相机标定工具”即可。</p>

<h4>3.1.2 关联标定</h4>

<p>​ 使用“九圆标定方法”进行关联标定，其步骤如下：</p>

<p>​ （1）使用激光振镜在一块标定板上采用线性阵列的方式打一 <strong>3 * 3</strong> 圆阵列（如下图红色区域所示），并记下每个圆在激光振镜下的圆心坐标；</p>

<p>​ （2）将做好的标定板放在待加工工件工装位置，使用相机进行图像采集，将采集图像链入“九圆关联标定工具”中；</p>

<p>​ （3）将记录的激光振镜坐标系下圆心坐标输入到下图绿色区域内；</p>

<p>​ （4）其余参数设置根据实际情况设置即可；</p>

<p><img src="media\Laser_3_1.png" alt="Laser_3_1" /></p>

<p>​ （5）需要特别注意“九圆关联标定工具”两个输入参数“X轴方向”和“Y轴方向”问题，根据工具定义，振镜坐标转换到统一的虚拟坐标系下方向为向右正，向下正，实际参数<strong>0</strong>为正方向，<strong>1</strong>代表反方向；</p>

<p><img src="media\Laser_3_2.png" alt="Laser_3_2" /></p>

<h3>3.2 定位引导</h3>

<p>​ 根据“2.2定位引导方案分析”的检测流程，结合项目实际情况对视觉工程进行介绍：</p>

<ul>
<li>几何定位特征选取工件内圆轮廓即可，如下图所示</li>
</ul>


<p><img src="media\Laser_3_3.png" alt="Laser_3_3" /></p>

<ul>
<li>工件中心的获取计算圆拟合和椭圆拟合中心点的中点来确定。这样做的目的在于如果只使用圆拟合圆心结果，其在后续的结果复检中会导致相关性验证不达标，综合多种测试方法，发现选取圆拟合和椭圆拟合中心点的中点方式相关性验证结果最好。注：相关性验证为视觉测量值与验收方检测值进行对比，要求其偏差值不能超过规定范围。</li>
</ul>


<p><img src="media/Laser_3_4.png" alt="" /></p>

<ul>
<li>上治具、右治具距离测量对象为治具尺寸，示意如下图所示，此步的目的在于考虑工件存在装夹不到位使工件搭放在治具上的情况，遂使用此方式进行防呆，其与计算后续工件中心到右、下治具距离具有相同作用。</li>
</ul>


<p><img src="media\Laser_3_5.png" alt="Laser_3_6" /></p>

<p><img src="media\Laser_3_6.png" alt="Laser_3_6" /></p>

<ul>
<li>将获取的椭圆中心作为工件中心输入到“振镜打标位置计算工具”中，链接标定阶段九圆标定结果，计算处工件中心在振镜坐标系下坐标；</li>
</ul>


<h3>3.3 结果复检</h3>

<p>​ 根据“2.3结果复检方案分析”的检测流程，结合项目实际情况对视觉工程进行介绍：</p>

<ul>
<li>几何定位特征选取工件内圆轮廓即可，与定位引导部分相同；</li>
<li>选取6个角点明显的字符进行字符点提取，将提取后的字符点放入字符点数组中；</li>
</ul>


<p><img src="media\Laser_3_7.png" alt="Laser_3_7" /></p>

<ul>
<li>字符角点提取如下图所示，即使用两个找线工具，获取其交点即可；</li>
</ul>


<p><img src="media\Laser_3_8.png" alt="Laser_3_8" /></p>

<ul>
<li>如“3.2 定位引导”部分所介绍，分别对字符点集进行圆拟合和椭圆拟合，获取中心，从而计算中点，作为结果复检字符中心；</li>
</ul>


<p><img src="media/Laser_3_9.png" alt="" /></p>

<ul>
<li>计算结果复检相关数据，其中字符点集圆周直径值=圆拟合半径+椭圆拟合半长轴+补偿值，此计算为相关性验证最优方式；</li>
</ul>


<h2>4.结果展示</h2>

<p><img src="media\Laser_4_1.png" alt="Laser_4_1" /></p>
