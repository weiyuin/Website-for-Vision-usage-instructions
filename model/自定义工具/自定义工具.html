<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>自定义工具</h1>

<h2>1. 功能概述</h2>

<p>自定义工具是一种特殊工具，它可以根据用户需要由用户自定义封装一组工具集合来完成用户需要的功能，用户可以将其作为一种特殊工具在工程中使用。同时，自定义工具还支持导入导出功能，以支持自定义工具跨软件，跨解决方案使用。</p>

<p><img src="media/CustomizeTool_1_1.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图1 自定义工具应用示意图</imgnote></p>

<h2>2. 应用场景</h2>

<p>1.在复杂的工业视觉解决方案中，通常有同样的一组工具集合在流程图中多处使用，导致工程开发，调试，维护工作量较大，自定义工具可以很好的解决这一问题。</p>

<p>2.在行业应用开发过程中，通常会有一些完成共性功能的工具集合在不同的解决方案都有使用，通过自定义工具导入导出功能，可以使这些共性功能一次开发，多处复用，有效的提升开发效率。</p>

<h2>3. 原理说明</h2>

<p>自定义工具主要包含输入参数，输出参数，内部流程图工具组成。自定义工具和普通工具类似，可以链接参数链，并执行。自定义工具没有属性参数。</p>

<h2>4. 使用向导</h2>

<h3>使用自定义工具</h3>

<ol>
<li>拖动添加使用</li>
</ol>


<p><img src="media/CustomizeTool_4_4.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图2 拖动使用自定义工具示意图</imgnote></p>

<ol>
<li>右键菜单添加使用</li>
</ol>


<p><img src="media/CustomizeTool_4_5.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图3 自定义工具应用示意图</imgnote></p>

<h4>编辑自定义工具</h4>

<p>1.流程图中自定义工具右键菜单单击编辑</p>

<p><img src="media/CustomizeTool_4_6.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图4 自定义工具编辑示意图</imgnote></p>

<p>2.编辑自定义工具</p>

<p>注意有部分工具不支持在自定义工具内部使用，具体请参见后面常见问题章节不支持工具列表。</p>

<p><img src="media/CustomizeTool_4_7.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图5 自定义工具编辑示意图</imgnote></p>

<h4>配置自定义工具参数</h4>

<p>输入参数由用户自定义配置，支持图像类型数据(scImage8, scImage24, scRangeImange16, Measure3D::GsProfileData), 基本数据类型(bool, float, double, int, string等)的参数配置，最多支持配置50个输入参数。</p>

<p>1.输入参数配置</p>

<p><img src="media/CustomizeTool_4_8.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图6 输入参数配置示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_9.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图7 输入参数配置示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_10.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图8 输入参数配置示意图</imgnote></p>

<p>2.输出参数配置</p>

<p>自定义工具内部任意工具的输出参数都可以配置为自定义工具的输出参数。最多支持配置50个输出参数。</p>

<p><img src="media/CustomizeTool_4_11.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图9 输出参数配置示意图</imgnote></p>

<p>3.图形数组输出参数配置</p>

<p>自定义工具内部任意工具的图形输出参数都可以添加到自定义工具的图形数组输出中。最多支持配置5个图形数组输出参数。每个图形分组最多可以添加2000个，非脚本工具可以添加1000个，脚本工具可以添加1000个。</p>

<p>注意：使用脚本添加的GUI，只有在脚本执行过后，才会在图形数组输出列表中显示；而且，这些GUI不支持使用“删除”或者“删除全部”按钮进行删除，只能修改或者注释掉脚本工具的相关代码。</p>

<p><img src="media/CustomizeTool_4_12.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图10 图形输出参数配置示意图</imgnote></p>

<h4>链接自定义工具参数</h4>

<p>配置好自定义工具的输入输出参数后，即可以在主程中配置自定义工具的参数链接。方式同普通工具。</p>

<p><img src="media/CustomizeTool_4_13.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图11 自定义工具参数链接配置示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_14.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图12 自定义工具参数链接配置示意图</imgnote></p>

<h4>自定义工具运行</h4>

<p>在给自定义工具配置完参数链后，即可运行自定义工具。如果自定义工具内部所有工具执行成功，认为自定义工具本身运行成功。如果自定义工具内部有工具执行失败，则认为自定义工具本身运行失败。</p>

<h4>自定义工具调试</h4>

<p>在主工程单步执行调试时，执行到自定义工具图元后，单步执行会开始执行自定义工具内部的工具，这时在自定义工具图元上单击右键菜单编辑选项进入自定义工具编辑界面，即可进入到自定义工具编辑界面，查看内部各工具单步执行情况。另外在自定义工具编辑界面，也可以直接启动调试或运行，但这时使用的输入参数数据是上次执行时缓存的数据。</p>

<p><img src="media/CustomizeTool_4_15.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图13 自定义工具调试示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_16.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图14 自定义工具调试示意图</imgnote></p>

<h4>自定义工具导出</h4>

<p>选中自定义工具，右键菜单中，选择导入导出->导出工具信息，即可导出自定义工具的信息。</p>

<p><img src="media/CustomizeTool_4_17.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图15 自定义工具导出示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_18.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图16 自定义工具导出示意图</imgnote></p>

<h4>自定义工具导入</h4>

<p>选中自定义工具，右键菜单中，选择导入导出->导入工具信息，即可导入自定义工具的信息，旧的内数据被清除，根据导入的gves文件重新创建内部数据。注意，此工具和与之相关的工具的参数可能会被断开。</p>

<p><img src="media/CustomizeTool_4_19.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图17 自定义工具导入示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_20.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图18 自定义工具导入示意图</imgnote></p>

<p>如果自定义工具内部添加了工具，会弹出自定义工具更新数据配置窗口，需要选择更新数据的工具。如果某些工具想要更新数据，勾选“使用B表数据”复选框，不勾选的话保留导入之前的工具数据。点击"确定"按钮的话，最新配置会被保留，并按照最新配置进行导入；点击“取消”按钮的话，修改的配置不会被保留，同时按照旧的配置进行导入。</p>

<p>注意：更新数据的工具只有名称相同的才需要配置，名称不同的使用gves文件中的数据；如果导入之前的工具数据影响流程图的参数链，即参数链的启用/禁用，可能出现自定义工具执行错误，需要手动修改此类型的工具参数；脚本工具不建议保留旧数据。</p>

<p><img src="media/CustomizeTool_4_24.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图19 自定义工具更新数据配置窗口</imgnote></p>

<h4>自定义工具更新</h4>

<p>选中自定义工具，右键菜单中，选择导入导出->更新工具信息，即可更新自定义工具的信息，旧的内数据被清除，根据导入的gves文件重新创建内部数据。注意，gves文件中的ID必须与被更新的工具ID一致，而且，参数个数和签名完全一致时，才会更新成功，目前此功能只用于批量复制。</p>

<p><img src="media/CustomizeTool_4_21.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图20 自定义工具更新示意图</imgnote></p>

<p><img src="media/CustomizeTool_4_22.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图21 自定义工具更新示意图</imgnote></p>

<h4>自定义工具快捷生成</h4>

<p>选中流程图中一段流程，右键点“转换为自定义工具”，可快速生成自定义工具。生成自定义工具后，选中的流程将被删除，自定义工具替换到相同的位置，转换之后不支持撤销，每次转换之前，最好先备份工程。</p>

<p><img src="media/CustomizeTool_4_23.png" alt="img" /></p>

<p>​                                                                                             <imgnote>图22 自定义工具快捷生成示意图</imgnote></p>

<p>选中流程需要满足以下需求，才可以转换成自定义工具，否则会提示无法完成转换：</p>

<p>（1）选中工具或图元必须大于等于两个，工具数必须小于等于100个；</p>

<p>（2）选中流程中不能包含自定义工具；</p>

<p>（3）选中流程中不能包含自定义工具不支持的工具，具体工具见常见问题中自定义工具不支持工具列表；</p>

<p>（4）选中流程中不能包含创建失败、损坏、状态异常的工具；</p>

<p>（5）选中流程中不能包含被折叠、加密的工具，组合要展开（转换后组合框线被删除）。</p>

<p>当脚本、表达式、文本生成工具被选中，但其访问的参数所在工具未被选中时，转换后脚本、表达式、文本生成工具将访问不到参数，会弹出提示，转换后脚本、表达式、文本生成工具会报错；当脚本、表达式、文本生成工具、数据输出工具未被选中，但其访问的参数所在工具被选中时，转换后脚本、表达式、文本生成工具、数据输出工具也将访问不到参数，会弹出提示，转换后脚本、表达式、文本生成工具、数据输出工具会报错。建议脚本、表达式、文本生成工具被选中时，同时选中其访问的工具，这样不会出现转换后无法访问的问题。否则只能在转换后手动修改。</p>

<p>选中工具的参数链链接了变量，或选中的脚本、表达式、数据输出工具访问了变量时，将自动生成自定义工具的参数链，自动链接所访问的变量；在自定义工具内部，生成的参数链会替代变量。当脚本或表达式修改变量值时，转换后会提示将新生成的自定义工具参数赋值给指定变量。</p>

<h2>5. 常见问题</h2>

<p><strong>注意事项</strong></p>

<ol>
<li>自定义工具输入参数最多支持配置50个。</li>
<li>自定义工具输出参数最多支持配置50个。</li>
<li>自定义工具支持5个图形数组输出，每个图形数组输出可以用脚本添加1000个GUI，也可以用非脚本工具添加1000个GUI，同一个GUI数据可以放到不同的图形数组中，但是不能放到同一个图形数组输出中。每个图形数组输出可以拖拽到视图上进行显示。</li>
<li>自定义工具支持内部局部变量，只能被自定义工具内部访问或者修改，不能被父工程访问或者修改 。</li>
<li>自定义工具目前不支持使用父工程局部变量、全局变量和指令管理变量，如需要使用可以通过配置输入参数传入。</li>
<li>自定义工具内部最多支持使用100个工具。</li>
</ol>


<h6>自定义工具不支持工具列表</h6>

<ol>
<li><p><strong>图像源</strong>
 图像源配置
 图像采集工具
 图像源工具
 图像文件
 图像文件夹
 图像保存工具
 屏幕截图工具
 多图拼合保存工具</p></li>
<li><p><strong>通信工具</strong>
 通信接收工具
 通信发送工具
 通信端口状态获取工具</p></li>
<li><p><strong>配置工具</strong>
 光源控制工具
 单相光源控制工具
 数据收集工具
 数据库更新工具
 数据库查询工具
 数据库数组查询工具
 数据库查询统计工具
 相机工作模式设置工具
 生产数据收集工具
 相机参数设置工具
 相机状态恢复工具</p></li>
<li><p><strong>显示与格式化工具</strong>
 文件夹创建工具
 视图清空工具
 消息报告工具
 Excel文件创建工具
 TXT文本写入工具
 数据输出工具
 数据来源配置工具
 图形数组生成工具
 Excel模板数据写入工具
 MDB数据存储工具
 文件解析导入工具</p></li>
<li><p><strong>3D工具</strong>
 3D图像采集工具
 3D相机设置工具
 3D格式转换工具
 多传感器拼接工具
 标准CAD模型比对工具</p></li>
<li><p><strong>其他</strong>
 批处理命令执行工具
 DI输入工具
 DO输出工具</p></li>
<li><p><strong>深度学习工具</strong>
 分类测试工具
 分割测试工具
 检测测试工具</p></li>
</ol>


<h2>6. 参数说明</h2>

<h3>输入参数</h3>

<p>用户自定义</p>

<h3>输出参数</h3>

<p>默认有执行时间和执行结果。其他由用户自定义。</p>

<h2>7. 示例工程</h2>

<p>参见“\Samples\自定义工具.gvp”。</p>
