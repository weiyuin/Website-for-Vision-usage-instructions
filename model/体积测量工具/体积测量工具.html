<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>体积测量工具</h1>

<h2>功能</h2>

<p>在3D测量中，体积测量工具主要是获取深度图像中检测区域内三维空间点构成的物体，在指定基平面上方的体积、在XOY面的投影面积和垂直高度。如图1所示为一个三棱锥物体在基平面上方的体积。</p>

<p><img src="media/wps11.jpg" alt="img" /></p>

<p><imgnote>图1 体积测量示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称         </th>
<th> 参数描述                                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口         </td>
<td> 平面方向                                                   </td>
<td> 分为两种：增加法向量一侧为正高度方向和减少法向量一侧为正高度方向。<img src="media/wps13.jpg" alt="img" /> </td>
</tr>
<tr>
<td></td>
<td> ROI类型        </td>
<td> 待检测区域，分为8种：整幅图像、矩形、仿射矩形、圆形、圆环、椭圆、多边形、多仿射矩形。                                                             </td>
</tr>
<tr>
<td></td>
<td> 最小高度阈值     </td>
<td> 根据最小高度阈值对计算得到的测量数据进行过滤。                                                                             </td>
</tr>
<tr>
<td></td>
<td> 启用垂直高度计算 </td>
<td> 选择“是”，则计算垂直高度。                                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 计算高度中值     </td>
<td> 选择“是”，则计算高度中值。                                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 启用掩膜         </td>
<td> 是否启用掩膜，选择“是”，显示掩膜个数、掩膜序号、掩膜形状等参数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 掩膜个数         </td>
<td> 设置启用的掩膜个数，取值范围为 [1, 99]。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 掩膜序号         </td>
<td> 当前欲设置的掩膜索引。                                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 掩膜类型       </td>
<td> 当前欲设置的掩膜形状，分为6种：矩形、仿射矩形、圆形、圆环、椭圆、多边形。                                                               </td>
</tr>
<tr>
<td></td>
<td> 体积上限 </td>
<td> 取值范围为[0, 100000]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 体积下限 </td>
<td> 取值范围为[0, 100000]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 面积上限 </td>
<td> 取值范围为[0, 100000]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 面积下限 </td>
<td> 取值范围为[0, 100000]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度最大值上限   </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度最大值下限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td></td>
<td> 高度最小值上限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度最小值下限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度均值上限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度均值下限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度中值上限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td></td>
<td> 高度中值下限 </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。 </td>
</tr>
<tr>
<td> 图像窗口         </td>
<td> 深度图像                                                     </td>
<td> 显示待检测的深度图像，显示为伪彩色图像。                     </td>
</tr>
<tr>
<td></td>
<td> 检测区域         </td>
<td> 在图像上显示待检测区域。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 掩膜区域         </td>
<td> 在图像上显示待掩膜区域。                                                                                                   </td>
</tr>
<tr>
<td> 数据链           </td>
<td> 深度图像                                                     </td>
<td> 输入待检测的深度图像。                                       </td>
</tr>
<tr>
<td></td>
<td> 基平面           </td>
<td> 选择高度测量的基准平面。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换     </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                                     </td>
</tr>
<tr>
<td> 高级界面         </td>
<td> 无     </td>
<td> 无 </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称             </th>
<th> 参数描述                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口             </td>
<td> 深度图像                                                     </td>
<td> 深度图像的长宽和像素大小，以及深度数据参数。 </td>
</tr>
<tr>
<td></td>
<td> 体积                 </td>
<td> 测量物体在指定基平面上的体积，单位：<strong>mm</strong><strong>3</strong>。<img src="media/wps15.jpg" alt="img" />                                               </td>
</tr>
<tr>
<td></td>
<td> 面积                 </td>
<td> XOY面的投影面积，单位：<strong>mm</strong><strong>2</strong>。                                                                       </td>
</tr>
<tr>
<td></td>
<td> 高度均值             </td>
<td> 高度数据的平均高度值。                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 高度中值             </td>
<td> 将高度数据排序后，位于中间位置的高度数据。                                                                 </td>
</tr>
<tr>
<td></td>
<td> 高度最小值           </td>
<td> 高度数据中最小高度数值。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 高度最大值           </td>
<td> 高度数据中最大高度数值。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 高度质心             </td>
<td> 测量物体质心的高度值。                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 区域边界框内像素数目 </td>
<td> 检测区域的最小外接矩形内像素（包含无效像素）的数目。                                                       </td>
</tr>
<tr>
<td></td>
<td> 关注像素数目         </td>
<td> 检测区域形状内像素（包含无效像素）的数目。                                                                 </td>
</tr>
<tr>
<td></td>
<td> 可见关注像素数目     </td>
<td> 检测区域形状内有效像素的数目。                                                                             </td>
</tr>
<tr>
<td></td>
<td> 所用像素数目         </td>
<td> 检测区域内实际用于高度测量的像素数目。                                                                     </td>
</tr>
<tr>
<td></td>
<td> 执行结果             </td>
<td> 工具执行结果。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 执行时间             </td>
<td> 工具执行时间。                                                                                             </td>
</tr>
<tr>
<td> 图像窗口             </td>
<td> 输出图像                                                     </td>
<td> 显示检测的深度图像，显示为伪彩色图像。       </td>
</tr>
<tr>
<td></td>
<td> 数据链               </td>
<td> 同监视窗口参数，供后续工具使用。                                                                           </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>体积、面积</h3>

<p>体积测量主要是根据三维数据点到指定基平面在相同二维坐标下的Z值差的累积和，以及深度图像像素表示的实际物理面积计算得到体积，主要是计算三维点到平面的Z值差，如图2所示。</p>

<p><img src="media/wps17.png" alt="img" /></p>

<p><imgnote>图1 体积、面积计算示意图</imgnote></p>

<p>设给定基平面为aX+bY+cZ+d=0，三维数据点为q<sub>i</sub>(x<sub>i</sub>,y<sub>i</sub>,z<sub>i</sub>), i = 1,2,…,n，一个深度图像像素表示的物理面积为△s=△x△y，其中，△x是像素x坐标的物理当量，△y是像素y坐标的物理当量，则检测区域内三维点所构成的物体到基平面之上的体积V为：</p>

<p><img src="media/wps18.png" alt="img" /></p>

<p>其中，Z<sub>plane</sub>(x<sub>i</sub>,y<sub>i</sub>)表示三维点q<sub>i</sub>在基平面aX+bY+cZ+d=0上的Z值。</p>

<p>由公式可知，所测量的体积是三维点的z坐标值与其对应在基平面上的Z<sub>Plane</sub>的差值累积和，与像素表示的物理面积之乘积。显然，三维点在平面上方对应的差值为正，在平面下方差值为负。</p>

<p>面积如图3所示，其计算公式为：</p>

<p><img src="media/wps19.png" alt="img" /></p>

<p>其中，δ(x,y)表示坐标(x,y)上的深度值是否符合要求，若符合其值为1，否则为0。</p>

<h3>使用向导</h3>

<p><strong>Step 1 设置平面侧方向</strong></p>

<p>执行体积计算时，需要确定测量的方向；平面侧方向共包含2种：IncreasingPlaneNormal和DecreasingPlaneNormal，其具体物理含义如下表所示。两种平面侧方向得到的测量数值是互为相反数的，因此，最终计算得到的体积也就不同。</p>

<p><img src="media/wps20.png" alt="img" /></p>

<p><strong>Step 2 设置检测区域及掩膜</strong></p>

<p>为了获取三维空间点数据需要设置检测区域及掩膜，其中，检测区域形状支持圆、椭圆、多边形、矩形、仿射矩形或圆环段等六种设置，掩膜支持一定数量（1~99）的圆、椭圆、多边形、矩形、仿射矩形和圆环段等六种区域设置；此时，体积测量使用的是检测区域形状内除去掩膜区域的三维空间点数据。</p>

<p><strong>Step 3 设置直方图统计</strong></p>

<p>设置测量参数主要是设置最小高度阈值参数，是根据该阈值对计算得到的测量数据进行过滤，以得到更加精确的体积。</p>

<p><strong>Step 4 执行测量与输出结果</strong></p>

<p>获取三维空间点数据后，执行测量就可以得到所测量物体的体积，并输出体积、面积、高度以及像素计数等结果。</p>

<h2>注意</h2>

<ul>
<li>体积测量中使用的基平面需要从其他工具链接（例如平面拟合工具2），若未链接基平面参数，测量过程中将使用默认值，默认基平面为Z=0的平面（即XOY面）。</li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\3D\深度图\3D测量工具.gvp”。</p>
