<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>瑕疵检测工具</h1>

<h2>功能</h2>

<p>在表面检测领域，针对素表面、灰度渐变、浅纹理背景物体表面的缺陷（脏污或细微瑕疵），瑕疵检测工具根据通过采样对相邻区域内的灰度变化即灰度梯度进行检测，以灰度梯度的变化程度来反映区域内是否存在瑕疵。这种方式在一定程度上避免了光照影响，克服了基于灰度检测方式的缺点。其示意图如图1所示。</p>

<p><img src="media/wps47.jpg" alt="img" />      <img src="media/wps48.jpg" alt="img" /></p>

<p><imgnote>(a) 输入图像</imgnote> <imgnote>(b) 瑕疵图像</imgnote></p>

<p><imgnote>图1 瑕疵检测工具示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称             </th>
<th> 参数描述                                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口             </td>
<td> ROI区域                                                      </td>
<td> 工具执行检测的区域，分为7种：整幅图像、矩形ROI、仿射矩形ROI、圆形ROI、圆环ROI、椭圆ROI和多边形ROI。 </td>
</tr>
<tr>
<td></td>
<td> 检测类型             </td>
<td> 瑕疵检测工具的检测类型分为2种：基于面积和基于分组。选择基于分组的检测类型时，显示是否填充、是否过滤面积、是否仅显示滤除后瑕疵三个参数。<a href="#_%E6%A3%80%E6%B5%8B%E7%B1%BB%E5%9E%8B"><img src="media/wps50.jpg" alt="img" /></a>                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否填充             </td>
<td> 选择“是”，则对瑕疵区域小于指定面积的缺陷进行填充，会影响瑕疵分组个数与总瑕疵量。仅在检测类型选择基于分组时有效。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否面积过滤         </td>
<td> 选择“是”，则对结果中面积小于面积过滤下限、大于面积过滤上限的瑕疵进行过滤。仅在检测类型选择基于分组时有效。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否仅显示滤除后瑕疵 </td>
<td> 选择“是”，则仅显示过滤后的瑕疵，否则将显示全部瑕疵。仅在检测类型选择基于分组时有效。                                                               </td>
</tr>
<tr>
<td></td>
<td> X方向瑕疵大小        </td>
<td> X方向上检测到的最小瑕疵的尺寸。                                                                                            </td>
</tr>
<tr>
<td></td>
<td> Y方向瑕疵大小        </td>
<td> Y方向上检测到的最小瑕疵的尺寸。                                                                                            </td>
</tr>
<tr>
<td></td>
<td> X方向移动量          </td>
<td> X方向上扫描移动步长。                                                                                                      </td>
</tr>
<tr>
<td></td>
<td> Y方向移动量          </td>
<td> Y方向上扫描移动步长。                                                                                                      </td>
</tr>
<tr>
<td></td>
<td> X方向比较段数量      </td>
<td> 计算X方向上某个采样点位置处瑕疵等级时所采用的比较区段，比较段的取值范围是[2, 20]。                                                               </td>
</tr>
<tr>
<td></td>
<td> Y方向比较段数量      </td>
<td> 计算Y方向上某个采样点位置处瑕疵等级时所采用的比较区段，比较段的取值范围是[2, 20]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 瑕疵等级阈值         </td>
<td> 表征当前位置瑕疵程度的参数，若当前位置的瑕疵等级超过该瑕疵等级阈值，则判定当前位置属于瑕疵。                                                               </td>
</tr>
<tr>
<td></td>
<td> 检测方向             </td>
<td> 即关注瑕疵出现（灰度变化）的方向，瑕疵检测工具的检测方向分为3种，X、Y和XY方向，主要使用XY方向。当只关注X或Y方向是否存在瑕疵时，选择X或Y方向；均关注时，选择XY方向。                                                               </td>
</tr>
<tr>
<td></td>
<td> 开启并行运算 </td>
<td> 是否开启并行运算，选择是时，算法将开启OpenMp并行计算方式，可以提升计算速度，但可能出现耗时不稳定的情况，选择否时，算法将关闭OpenMp并行计算。 </td>
</tr>
<tr>
<td></td>
<td> 线程数百分比 </td>
<td> 设置并行运算的线程数百分比，有效范围为 (0, 0.75]，对应表示(0%, 75%]百分比范围。 </td>
</tr>
<tr>
<td> 图像窗口             </td>
<td> ROI区域                                                      </td>
<td> 图像中指定的 矩形/仿射矩形/圆形/圆环/椭圆形/多边形 检测区域。 </td>
</tr>
<tr>
<td></td>
<td> 输入图像             </td>
<td> 显示待检测的图像。                                                                                                         </td>
</tr>
<tr>
<td> 数据链               </td>
<td> 输入图像                                                     </td>
<td> 输入图像宽度、高度、像素大小，同图像窗口的输入图像参数。     </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换         </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                                     </td>
</tr>
<tr>
<td>高级界面</td>
<td> 无            </td>
<td> 无                                                                                                                         </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称     </th>
<th> 参数描述                                                                                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口     </td>
<td> 输入图像                                                     </td>
<td> 输出图像宽度、高度、像素大小。                           </td>
</tr>
<tr>
<td></td>
<td> 瑕疵分组个数 </td>
<td> 属性窗口检测类型参数选择基于分组时，瑕疵分组的个数。选择基于面积时，瑕疵分组个数值为1。                                                           </td>
</tr>
<tr>
<td></td>
<td> 总瑕疵量     </td>
<td> 检测到的总体瑕疵量。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 瑕疵结果     </td>
<td> 瑕疵的具体信息，包含每个瑕疵的瑕疵量和瑕疵质心。                                                                       </td>
</tr>
<tr>
<td></td>
<td> 执行结果     </td>
<td> 工具执行结果。                                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 执行时间     </td>
<td> 工具执行时间。                                                                                                         </td>
</tr>
<tr>
<td> 图像窗口     </td>
<td> 输入图像                                                     </td>
<td> 显示工具执行结果图像，同监视窗口的输入图像参数。         </td>
</tr>
<tr>
<td></td>
<td> 瑕疵结果     </td>
<td> 显示图像查找区域内的瑕疵结果。                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 执行结果     </td>
<td> 显示工具执行结果，执行成功显示“OK”，执行失败显示“NG”，同监视窗口的执行结果参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 结果图像 </td>
<td> 瑕疵检测结果图（采样后的能量图） </td>
</tr>
<tr>
<td></td>
<td> Defect显示 </td>
<td> 瑕疵检测所有Blob结果（缺陷结果）                             </td>
</tr>
<tr>
<td> 数据链       </td>
<td> 瑕疵分组个数 </td>
<td> 瑕疵分组的个数，供后序工具使用，同监视窗口的瑕疵分组个数参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 总瑕疵量     </td>
<td> 检测到的总体瑕疵量，供后序工具使用，同监视窗口的总瑕疵量参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 瑕疵结果     </td>
<td> 瑕疵的具体信息，包含每个瑕疵的瑕疵量和瑕疵质心，供后序工具使用，同监视窗口的瑕疵结果参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 梯度结果图形     </td>
<td> 瑕疵等级判定图                                               </td>
</tr>
<tr>
<td></td>
<td> 原图中的结果图像     </td>
<td> 瑕疵检测结果图（能量图在原图上呈现）                                       </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>检测类型</h3>

<p>基于面积的检测，只关注物体表面是否存在瑕疵，以及瑕疵的总量，并不关注瑕疵的具体形态和分布信息；基于分组的检测，除了关注总的瑕疵量外，仍会关注瑕疵的分组数、每组瑕疵的具体形态及分布，还可以对瑕疵进行预处理及筛选。比如可以针对具体情况进行缺陷填充，或对检测出来的瑕疵进行面积过滤。</p>

<p><img src="media/wps53.jpg" alt="img" />      <img src="media/wps54.jpg" alt="img" /></p>

<p><imgnote>(a) 基于面积</imgnote> <imgnote>(b) 基于分组</imgnote></p>

<p><imgnote>图2 检测类型示意图</imgnote></p>

<h2>注意</h2>

<ul>
<li><p>瑕疵比较细微时，X、Y方向上的瑕疵大小可以设置的小一些；反之可以适当增大，以提高检测效率，但瑕疵大小不可以设置过大，否则可能检测不到瑕疵。</p></li>
<li><p>X、Y方向上的移动量设置的越大，图像中参与采样计算的点越少，但最小是一个像素，同时移动量越大则采样点越稀疏，检测效率越高。</p></li>
<li><p>X、Y方向上的比较段数量设置的越大，则瑕疵的受影响范围越大。如果想要得到比较精细的瑕疵轮廓，则比较段数量应当适当设置的小一些。比较段数量越大，检测效率越低。</p></li>
<li><p>检测类型选择基于面积时，监视窗口瑕疵结果中的质心坐标为(-1.000000，-1.000000)。</p></li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\瑕疵检测工具.gvp”。</p>
