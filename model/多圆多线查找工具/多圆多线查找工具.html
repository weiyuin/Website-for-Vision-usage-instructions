<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1><strong>多圆多线查找</strong></h1>

<h2>1. 功能概述</h2>

<p>​ 多圆多线查找工具对软件原先的高级找线工具、找圆工具、求交点、中点、连线工具进行集成，用户可根据具体需求选择对应的工具并进行输出。</p>

<p>​ 图1是对工具整个功能涵盖的截图，图中共分为四个功能模块。其中：a为工具的高级界面首页，左侧为添加线、圆查找工具的参数设置页面，右侧为输入、输出图像显示区域；b为交点/中点求解页面，列表中直接添加对应特征点；c为连线/均线检测页面，选择对应特征点或线生成对应的连线、均线结果；d为输出结果选择页面；</p>

<p><img src="media/GcMultiCircleLineFindTool_1_1.png" alt="" /></p>

<p><imgnote>图1 多圆多线工具界面说明</imgnote></p>

<h2>2. 应用场景</h2>

<p>​ 多圆多线查找旨在为量测类或对位类项目直接输出线、圆或特征点数据用作定位或抓取参考，量测类项目直接对输出元素进行链接操作，而对位类项目则利用线、特征点组成的数组输出给标定类工具作为输入。工具内部可通过添加线、圆查找工作来对实际项目中物料进行粗定位，再由得到的线圆结果求解特征点作为参考点来精定位，该工具试用于一切线圆查找类场景。</p>

<p><img src="media/GcMultiCircleLineFindTool_2_1.png" alt="" /></p>

<h2>3. 原理说明</h2>

<p>​ 多圆多线查找通过对基础线圆卡尺的摆放，找到对应的特征线、特征圆，再由线圆特征，生成关联元素对应的交点位置，由交点可计算得到图像中对应的中点位置，利用计算得到的特征点可以直接生成新的连线，再利用线之间的夹角计算得出多条线组合的中心线角度，利用循环计算特征量的方式得到一系列关联标定或参考点定位过程中的关键变量，输出可自定义命名、排序，数组、数值的方式用于不同项目背景下的直接链接。</p>

<h2>4. 使用向导</h2>

<ul>
<li><h4>添加工具，载入图像</h4></li>
</ul>


<p><img src="media/GcMultiCircleLineFindTool_4_1.png" alt="" /></p>

<ul>
<li><h4>线圆查找</h4>

<p><img src="media/GcMultiCircleLineFindTool_4_2.png" alt="" /></p>

<p>​   此页面代替传统的找线工具、找圆工具，用户切换下拉框选择直线/圆，点击“+”号后加入一个对应的找线/圆子工具，然后把图像上的卡尺拖到检测位置，创建新的子工具，加载默认参数。用户如要配置自定义参数，可选中相应的工具，切换到该工具参数界面，进行修改，如下图：</p>

<p><img src="media/GcMultiCircleLineFindTool_4_3.png" alt="" /></p>

<p><img src="media/GcMultiCircleLineFindTool_4_3_1.png" alt="" /></p>

<p>​    “实时刷新”：修改参数后，若要在输入图像中实时查看结果，可勾选“实时刷新”选项。若不勾选，则改完参数后，需要重新“执行”，才会刷新执行结果。需要注意：如子工具过多情况下，开启实时刷新后可能有卡顿的现象，谨慎操作；同时，使用者可以通过↑↓来控制项目的执行顺序，如下图所示：</p>

<p><img src="media/GcMultiCircleLineFindTool_4_21.gif" alt="" /></p></li>
<li><h4>交点/中点设置界面</h4>

<p>此页面集成了线/圆交点工具、中点生成工具。页面功能默认关闭，根据需要选择开启。</p>

<p>交点操作规则：</p>

<ol>
<li>可以添加线-线、线-圆、圆-圆的交点。</li>
<li>不可以添加重复交点，重复交点：来源相同的点。</li>
<li>修改线圆或交点关系链，导致交点个数增加，则新增交点；交点个数减少，减少的点变为无效点。</li>
<li>删除一个交点，同时删除来源相同的点。</li>
</ol>


<p>用于求出线-线，线-圆，圆-圆的交点。按提示选择两个输入元素，工具输出其交点，具体操作步骤如下：</p>

<p><strong>Step 1</strong> 开启对应检测项并点击“＋”号；</p>

<p><strong>Step 2</strong> 图像窗口单击选择第一个输入项；</p>

<p><strong>Step 3</strong> 图像窗口单击选择第二个输入项；</p>

<p><img src="media/GcMultiCircleLineFindTool_4_5.png" alt="" /><img src="media\GcMultiCircleLineFindTool_4_4.png" alt="" /></p>

<p><strong>Step 4</strong> 工具自动生成对应的输出项，双击可进行重命名；</p></li>
</ul>


<p><img src="media/GcMultiCircleLineFindTool_4_6.png" alt="" /></p>

<p>  用于求出两个点的中点。按提示选择两个输入元素，工具输出其交点，具体操作步骤如下：</p>

<p>  <strong>Step 1</strong> 开启对应检测项并点击“＋”号；</p>

<p>  <strong>Step 2</strong> 图像窗口单击选择第一个输入项（交点/中点）；</p>

<p>  <strong>Step 3</strong> 图像窗口单击选择第二个输入项（交点/中点）；</p>

<p><img src="media/GcMultiCircleLineFindTool_4_7.png" alt="" /><img src="media\GcMultiCircleLineFindTool_4_8.png" alt="" /></p>

<p>  <strong>Step 4</strong> 工具自动生成对应的输出项，双击可进行重命名；</p>

<p><img src="media/GcMultiCircleLineFindTool_4_9.png" alt="" /></p>

<ul>
<li><h4>连线/均线设置界面</h4>

<p>此页面包括连线角度计算、均线角度计算。页面功能默认关闭，根据需要选择开启。</p>

<p>用于生成两点的连线。按提示选择两个输入元素，工具输出连线结果，具体操作步骤如下：</p>

<p><strong>Step 1</strong> 开启对应检测项并点击“＋”号；</p>

<p><strong>Step 2</strong> 图像窗口单击选择第一个输入项（交点/中点）</p>

<p><strong>Step 3</strong> 图像窗口单击选择第二个输入项（交点/中点）</p>

<p><img src="media/GcMultiCircleLineFindTool_4_10.png" alt="" /></p>

<p><img src="media/GcMultiCircleLineFindTool_4_11.png" alt="" /></p>

<p><strong>Step 4</strong> 工具自动生成两点连线，双击可进行重命名</p>

<p><strong>Step 5</strong> 列表（或图像上）选中生成的连线，设置角度归一化范围</p>

<p><img src="media/GcMultiCircleLineFindTool_4_13.png" alt="" /></p>

<p>用于计算多条直线的平均角度a，并输出一条经过图像原点（0,0），角度为a的直线。按提示加入直线元素，工具输出一条所有输入直线的均线，具体操作步骤如下：</p>

<p><strong>Step 1</strong> 开启对应检测项并点击“＋”号；</p>

<p><strong>Step 2</strong> 图像窗口单击选择输入项（直线/连线）</p>

<p><img src="media/GcMultiCircleLineFindTool_4_14.png" alt="" /></p>

<p><img src="media/GcMultiCircleLineFindTool_4_15.png" alt="" /></p>

<blockquote><p><span style="color:red">注意</span></p>

<p>若使用者需要修改某个交点的生成方式，可以按下方方式修改
<img src="media/GcMultiCircleLineFindTool_4_20.gif" alt="" /></p></blockquote>

<p><strong>Step 3</strong> 再次点击“＋”号；</p>

<p><strong>Step 4</strong> 图像窗口单击选择输入项（直线/连线）</p>

<p><strong>Step 5</strong> 工具计算平均角度，自动生成均线</p>

<p><img src="media/GcMultiCircleLineFindTool_4_16.png" alt="" /></p></li>
<li><h4>输出结果选择设置界面</h4>

<p>此页面用于选择工具的最终输出项，上方列表中，左侧列表显示待选择输出的线元素，右侧列表显示已选择输出的线元素，下方列表中，左侧列表显示待选择输出的点和圆元素，右侧列表显示已选择输出的点和圆元素。输出列表中，按照选择的序号进行输出。</p>

<p>在点、圆输出列表中，前8个对应点元素的输出，后8个对应圆的输出。</p>

<p>具体操作步骤如下：</p>

<p><strong>Step 1</strong> 选中一项，移动到输出列表：</p>

<p>   在左侧列表中选中要输出的元素，在右侧列表中选中该元素要输出的序号，点击 => 按钮进行移动；输出元素固定为每种类型输出8个；对于圆的输出，在选择输出序号时，选择从序号8开始的一项。</p>

<p>对于输出项，可以通过上移和下移按钮修改输出的顺序。数组的输出，按照配置的顺序进行输出，包括线数组、线段数组、点数组，点数组中包括点和圆心。</p></li>
</ul>


<p><img src="media/GcMultiCircleLineFindTool_4_17.png" alt="" /></p>

<p>  <strong>Step 2</strong> 工具执行后，输出配置的项目。</p>

<p><img src="media/GcMultiCircleLineFindTool_4_19.png" alt="" /></p>

<h2>5. 常见问题</h2>

<table>
<thead>
<tr>
<th> 现象描述                                                     </th>
<th> 解决方法                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td> 选择参考直线时，”点击“下拉框选择需要引用的直线，下拉框为空，无直线可选择； </td>
<td> 由于参考直线引用项是需要确定当前直线在列表位置的，仅能引用该直线前面的直线结果作为参考，所以，遇到该情况时，应点击列表或者点击图像中对应的当前直线，这样就能刷新引用列表中的内容 </td>
</tr>
</tbody>
</table>


<h2>6. 参数说明</h2>

<h4>输入参数</h4>

<table>
<thead>
<tr>
<th>          找线输入参数          </th>
<th> 找线参数说明                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>            边缘模式            </td>
<td> 卡尺工具的边缘模式有2种，单边缘和双边缘。                    </td>
</tr>
<tr>
<td>            边缘极性            </td>
<td> 边缘极性是指图像边缘灰度级的过渡形式，分为3种，任意极性、亮到暗和暗到亮。 </td>
</tr>
<tr>
<td>           对比度阈值           </td>
<td> 卡尺工具默认只采用对比度评价分数，即按照边缘信号的强度来评分，输出边缘最强的点。对比度阈值的取值范围是0~255。 </td>
</tr>
<tr>
<td>            边缘属性            </td>
<td> 在查找区域内，卡尺根据不同的边缘属性，确定图像边缘的精确位置。卡尺工具的边缘属性有5种，最佳边缘、第一条边缘、最后一条边缘、离中心最近边缘、期望灰    度边缘。期望灰度边缘仅在边缘模式选择“单边缘”时才可用。 </td>
</tr>
<tr>
<td>         暗侧期望灰度值         </td>
<td> 期望边缘暗侧的灰度值。边缘属性选择“期望灰度边缘”时才可用。   </td>
</tr>
<tr>
<td>         亮侧期望灰度值         </td>
<td> 期望边缘亮侧的灰度值。边缘属性选择“期望灰度边缘”时才可用。   </td>
</tr>
<tr>
<td>           局外点比例           </td>
<td> 局外点就是偏离曲线较远的点。局外点比例即不参与直线拟合的点的比例，取值范围是0~0.5。 </td>
</tr>
<tr>
<td>        角度限制        </td>
<td> 使用角度约束限制在设定的角度范围内找线。                     </td>
</tr>
<tr>
<td>            期望角度            </td>
<td> 预期的直线角度                                               </td>
</tr>
<tr>
<td>          最大偏差          </td>
<td> 和预期直线角度的误差。实际找线角度范围为：[期望角度-最大偏差，期望角度+最大偏差]，例如期望角度位10°，最大角度偏差为5°，则实际查找范围为[5°，15°]，10±5° </td>
</tr>
<tr>
<td>            掩膜模式            </td>
<td> 掩膜设置是指在模板训练过程中，屏蔽掉不参与模式训练的区域，减少参与模式训练的几何特征。 </td>
</tr>
<tr>
<td>            手动模式            </td>
<td> 选择“是”，支持手动设置卡尺参数，鼠标右键点击卡尺，在弹出的对话框中可以改变卡尺参数；选择“否”，不支持手动设置卡尺参数。 </td>
</tr>
<tr>
<td>           显示探测点           </td>
<td> 选择“是”，显示卡尺的探测点，同时输出探测点，每个卡尺对应一个探测点，可以作为其他工具的输入参数；选择“否”，不显示卡尺的探测点。其中局外点用红色标注，其余用绿色标注。 </td>
</tr>
<tr>
<td>          开启平行偏移          </td>
<td> 选择“是”，根据平行偏移量参数对结果直线，进行平移操作。       </td>
</tr>
<tr>
<td>          开启参考直线          </td>
<td> 以指定参考直线为依据，对仿射矩形的搜索区域进行位置限制。选择“是”，显示修正类型参数、参考允许的角度偏差参数和参考直线距离参数。注意：当参考直线距离为0.000000的时候，相当于不开启参考直线。 </td>
</tr>
<tr>
<td>            修正类型            </td>
<td> 修正类型分为2种，平行和垂直。                                </td>
</tr>
<tr>
<td>       参考允许的角度偏差       </td>
<td> 输入直线允许的角度偏差阈值，如果角度偏差超过阈值，以参考直线的角度修正。 </td>
</tr>
<tr>
<td> 参考直线距离(左上为负右下为正) </td>
<td> 输入参考直线的距离。其中：左、上方为负值；右、下方为正值。   </td>
</tr>
<tr>
<td>           角度归一化           </td>
<td> 角度归一化是指对直线的角度进行转换，使之限定在一定的范围内。角度归一化有3种，[-90°,   90°)、[-180°, 180°)、[0°, 180°) </td>
</tr>
<tr>
<td>       质心X上限                </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td>       质心X下限                </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td>       质心Y上限                </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td>       质心Y下限                </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td>       直线绝对角度上限         </td>
<td> 取值范围[-180.0, 360.0) </td>
</tr>
<tr>
<td>       直线绝对角度下限         </td>
<td> 取值范围[-180.0, 360.0) </td>
</tr>
<tr>
<td>       直线变化角度上限         </td>
<td> 取值范围[-90.0, 90.0) </td>
</tr>
<tr>
<td>       直线变化角度下限         </td>
<td> 取值范围[-90.0, 90.0) </td>
</tr>
</tbody>
</table>


<table>
<thead>
<tr>
<th>   找圆输入参数   </th>
<th> 找圆参数说明                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>     边缘极性     </td>
<td> 边缘极性是指图像边缘灰度级的过渡形式，分为3种，任意极性、亮到暗和暗到亮。 </td>
</tr>
<tr>
<td>     边缘模式     </td>
<td> 找圆工具的边缘模式有2种，单边缘和双边缘。                    </td>
</tr>
<tr>
<td>    对比度阈值    </td>
<td> 卡尺工具默认只采用对比度评价分数，即按照边缘信号的强度来评分，输出边缘最强的点。对比度阈值的取值范围是0~255。 </td>
</tr>
<tr>
<td>    局外点比例    </td>
<td> 局外点就是偏离曲线较远的点。局外点比例即不参与直线拟合的点的比例，取值范围是0~0.5。 </td>
</tr>
<tr>
<td>     边缘属性     </td>
<td> 在查找区域内，卡尺根据不同的边缘属性，确定图像边缘的精确位置。卡尺工具的边缘属性有9种，最佳边缘、第一条边缘、最后一条边缘、整体最亮边缘、整体最暗边缘、亮侧最亮边缘、亮侧最暗边缘、暗侧最亮边缘和暗侧最暗边缘。 </td>
</tr>
<tr>
<td> 启用全局最优拟合 </td>
<td> 是否启用全局最优拟合                                         </td>
</tr>
<tr>
<td>   启用重新评分   </td>
<td> 是否启用重新评分                                             </td>
</tr>
<tr>
<td>  允许减少局外点  </td>
<td> 是否允许减少局外点                                           </td>
</tr>
<tr>
<td>     掩膜模式     </td>
<td> 掩膜设置是指在模板训练过程中，屏蔽掉不参与模式训练的区域，减少参与模式训练的几何特征。 </td>
</tr>
<tr>
<td>     手动模式     </td>
<td> 选择“是”，支持手动设置卡尺参数，鼠标右键点击卡尺，在弹出的对话框中可以改变卡尺参数；选择“否”，不支持手动设置卡尺参数。 </td>
</tr>
<tr>
<td>    显示探测点    </td>
<td> 选择“是”，显示卡尺的探测点；选择“否”，不显示卡尺的探测点。其中局外点用红色标注，其余用绿色标注。 </td>
</tr>
<tr>
<td> 圆心X上限        </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td> 圆心X下限        </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td> 圆心Y上限        </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td> 圆心Y下限        </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td> 半径上限         </td>
<td> 取值范围(0,999999) </td>
</tr>
<tr>
<td> 半径下限         </td>
<td> 取值范围(0,999999) </td>
</tr>
</tbody>
</table>


<h4>输出参数</h4>

<table>
<thead>
<tr>
<th> 参数名称 </th>
<th> 参数说明                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td> 输出图像               </td>
<td> 输出图像数据，与输入图像无差别；                             </td>
</tr>
<tr>
<td> 输出直线数组         </td>
<td> 输出直线的集合，最大有8条直线      </td>
</tr>
<tr>
<td> 输出线段数组        </td>
<td> 输出线段的集合，最大8条线段 </td>
</tr>
<tr>
<td> 输出点数组           </td>
<td> 输出点的集合，最大8个点 </td>
</tr>
<tr>
<td> 输出错误线ROI数组 </td>
<td> 输出错误直线ROI的集合 </td>
</tr>
<tr>
<td> 输出错误圆ROI数组  </td>
<td> 错误错误圆ROI的集合 </td>
</tr>
<tr>
<td> 线1-8              </td>
<td> 线输出1-8     </td>
</tr>
<tr>
<td> 线段1-8              </td>
<td> 线段输出1-8     </td>
</tr>
<tr>
<td> 角度1-8              </td>
<td> 角度输出1-8    </td>
</tr>
<tr>
<td> 圆1-8              </td>
<td> 圆输出1-8     </td>
</tr>
<tr>
<td> 点1-8              </td>
<td> 点输出1-8     </td>
</tr>
<tr>
<td> 执行时间               </td>
<td> 执行时间单位：ms；                                           </td>
</tr>
</tbody>
</table>


<table>
<thead>
<tr>
<th> 参数名称（数值模式下） </th>
<th> 参数说明                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 输出图像               </td>
<td> 输出图像数据，与输入图像无差别；                           </td>
</tr>
<tr>
<td> 数值输出               </td>
<td> 数值主要分为直线、点、圆结果，命名采用列表中自定义名称输出 </td>
</tr>
<tr>
<td> 执行结果               </td>
<td> 执行结果为布尔类型，true：成功，false：失败；              </td>
</tr>
<tr>
<td> 执行时间               </td>
<td> 执行时间单位：ms；                                         </td>
</tr>
</tbody>
</table>


<h2>7. 示例工程</h2>

<p>参见“\Samples\多圆多线查找工具.gvp”。</p>
