<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>点选标定管理</h1>

<h2>1. 功能概述</h2>

<p>工程/解决方案中使用的点选标定结果，通过功能区-设置面板里面的“点选标定管理”进行管理。</p>

<p>如图所示为点选标定管理窗口，显示当前解决方案中的点选标定加载的文件信息。窗口菜单栏分为<strong>文件、工具和视图</strong>，文件包含STL和点云文件的<u>加载</u>及标定结果的<u>导出</u>功能；工具包含<u>点对选取、对齐、标定验证</u>和<u>重新标定</u>功能；视图主要是对<u>场景中的选点、对齐后的点云以及所有场景中的元素</u>进行删除的功能。</p>

<p><img src="media/%E7%82%B9%E9%80%89%E6%A0%87%E5%AE%9A%E7%AE%A1%E7%90%861_1.png" alt="" /></p>

<h2>2. 使用向导</h2>

<h3>1）加载STL</h3>

<p>选择“文件-加载STL”，弹出加载STL对话框，在对话框中可以设置路径、网格颜色、显示模式等信息。</p>

<p><img src="media/%E5%8A%A0%E8%BD%BDSTL2_1.png" alt="" /></p>

<ul>
<li>路径：模型文件所在本地的路径，目前支持格式为 “stl” 的模型文件</li>
<li>网格颜色：显示的颜色，分别在R、G、B三个通道进行颜色的设置</li>
<li>显示模式：分为曲面模式、线框模式和点云模式；<strong>曲面是面片的形式，线框只有线条，点云模式只有顶点</strong></li>
</ul>


<h3>2）加载点云</h3>

<p>选择“文件-加载点云”，弹出加载点云对话框，在对话框中可以设置路径、网格颜色、点云尺寸等信息。</p>

<p><img src="media/%E5%8A%A0%E8%BD%BD%E7%82%B9%E4%BA%912_2.png" alt="" /></p>

<ul>
<li>路径：模型文件所在本地的路径，目前支持格式为 “ply”或“txt” 的点云文件</li>
<li>网格颜色：显示的颜色，分别在R、G、B三个通道进行颜色的设置</li>
<li>点云尺寸：显示点云的点的大小，取值范围[1, 50]</li>
</ul>


<p><strong>【备注】</strong>目前最多支持加载16张点云</p>

<h3>3）点对选取</h3>

<p>选择“工具-点对”，可以分别在模型和点云上取点，当选点有误可以进行撤销（目前<strong>仅支持删除最后一次选点功</strong>能）。</p>

<p><img src="media/%E7%82%B9%E5%AF%B9%E9%80%89%E5%8F%962_3.png" alt="" /></p>

<ul>
<li>名称：代表当前选中的点云，比如加载了4个点云，只有第2个点云选中，则为点对2</li>
<li>方式：目前只支持N点对齐，就是多点对齐的模式</li>
<li>点选：点击点选按钮，可以在模型和点云上进行选点；点云上的点可以显示数字，即目前的点个数</li>
<li>取消：点击取消按钮，回到文件列表界面并取消选点模式</li>
<li>确定：点击确定按钮，完成选点并开始执行预对齐</li>
<li>撤销：点击撤销按钮，删除最后一次选点</li>
</ul>


<p><strong>【备注】</strong></p>

<ul>
<li><p>在点选之前先把两个窗口的视图尽量旋转到合适位置，（即两边窗口的图像都能选中相同位置的三个点以上）
然后点击“点选”</p></li>
<li><p>当选择点对功能，才会有确定和取消按钮</p></li>
<li>选点：在模型上选了一个点，必须要在点云上也选一个点，最少各选四个点以上</li>
</ul>


<h3>4）对齐</h3>

<p>点击确定按钮，选点完毕并将模型和点云的点对建立关系，并将点云根据变换矩阵转换到模型上。</p>

<p><img src="media/%E9%A2%84%E5%AF%B9%E9%BD%902_4.png" alt="" /></p>

<p>在最佳拟合对齐界面设置采样比率、最大迭代次数、无约束和世界坐标系及锁定移动和旋转，点击开始按钮执行精对齐，并将点云根据变换矩阵转换到模型上；点击关闭，退出最佳拟合对齐界面。</p>

<p><img src="media/%E6%9C%80%E4%BD%B3%E6%8B%9F%E5%90%88%E5%AF%B9%E9%BD%902_5.png" alt="" /></p>

<ul>
<li>采样比率：默认0.8，可设置范围（0.00001~1），根据项目需求设置，若对效率要求高则可设置采样率较低；</li>
<li>最大迭代次数：拟合迭代最大次数，默认10次，根据项目需求设置，建议采样率比较小时，最大重复次数设置大一些；</li>
<li>约束条件：可以选择无约束或世界坐标系，根据需求设置是否约束；</li>
<li>锁定移动：锁定移动则对齐过程不会在锁定方向平移；</li>
<li>锁定旋转：锁定旋转则对齐过程不会在锁定方向旋转；</li>
<li>标定结果：分为标定矩阵和收敛值（<strong>即最小均方误差RMS，值越小越好，一般0.000010左右最佳</strong>）</li>
<li>开始：点击开始按钮，开始执行最佳拟合对齐</li>
<li>关闭：点击关闭按钮，回到文件列表界面</li>
</ul>


<h3>5）导出当前点云标定矩阵</h3>

<p>最佳拟合对齐成功后，回到初始界面并导出结果矩阵。</p>

<p><img src="media/%E5%AF%BC%E5%87%BA%E5%BD%93%E5%89%8D%E7%82%B9%E4%BA%91%E5%AF%B9%E5%BA%94%E7%9F%A9%E9%98%B52_6.png" alt="" /></p>

<p><strong>（※：其他点云标定的操作方法一样）</strong></p>

<h3>6）标定验证</h3>

<p>数据标定完之后，可以测量一下看看对齐效果，选择“工具-标定验证”，可以对标定结果进行验证，对应点云导入标定文件。</p>

<p><img src="media/%E6%A0%87%E5%AE%9A%E9%AA%8C%E8%AF%812_7.png" alt="" /></p>

<p><strong>（※：其他点云标定验证的操作方法一样）</strong></p>

<h3>7）重新标定</h3>

<p>当标定效果满足不了要求，可以选择“工具-重新标定”，重新开始标定。</p>

<h3>8）导出标定结果</h3>

<p>当所有点云文件标定成功，可以导出标定结果（即<strong>输出结果</strong>），可直接作为点云变换和点云拼接的外部输入矩阵。</p>

<p><img src="media/%E5%AF%BC%E5%87%BA%E7%BB%93%E6%9E%9C2_8.png" alt="" /></p>

<h3>9）视图说明</h3>

<p>当希望批量删除点云或模型中的选点，选择“视图-场景元素删除”；当希望批量删除对齐后的点云，选择“视图-对齐点云删除”；当希望删除视图中所有内容，选择“所有元素删除”；</p>

<p><img src="media/%E8%A7%86%E5%9B%BE2_9.png" alt="" /></p>

<h2>3.错误消息及处理办法</h2>

<table>
<thead>
<tr>
<th> 错误消息                                            </th>
<th> 原因和处理办法                             </th>
</tr>
</thead>
<tbody>
<tr>
<td> 内存错误                                            </td>
<td> 一般是电脑内存不足导致                     </td>
</tr>
<tr>
<td> 内部错误                                            </td>
<td> 一般是其他未知问题导致，比如系统环境问题   </td>
</tr>
<tr>
<td> 两个特征点集的点数不相等                            </td>
<td> 保证模型上的选点和点云上的选点保持一致     </td>
</tr>
<tr>
<td> 特征点不足                                          </td>
<td> 选点对个数需要大于4                        </td>
</tr>
<tr>
<td> 特征点共面                                          </td>
<td> 一般是特征点的选取有误，特征点处于共面状态 </td>
</tr>
<tr>
<td> 外参求解方法错误                                    </td>
<td> 一般是标定算法的求解有误                   </td>
</tr>
<tr>
<td> 旋转角度获取错误                                    </td>
<td> 旋转角度结果有误                           </td>
</tr>
<tr>
<td> 标定距离阈值设置错误：阈值过小，致使标定点对数不足4 </td>
<td> 一般是标定阈值的设置有误                   </td>
</tr>
<tr>
<td> 所有姿态锁定                                        </td>
<td> 一般是约束条件设置有误                     </td>
</tr>
<tr>
<td> 无效KD-Tree数据                                     </td>
<td> 一般和点云文件有关                         </td>
</tr>
<tr>
<td> 符合阈值的最小距离点对不足                          </td>
<td> 阈值设置有误，重新设置阈值                 </td>
</tr>
<tr>
<td> 输入数据采样后数量不足                              </td>
<td> 一般需要重新设置采样比率                   </td>
</tr>
<tr>
<td> 法向量数量与点云不一致                              </td>
<td> 一般是法向量和点云不匹配                   </td>
</tr>
<tr>
<td> 索引数量与点云不一致                                </td>
<td> 一般是索引和点云不匹配                     </td>
</tr>
<tr>
<td> 未训练                                              </td>
<td> 需要进行训练                               </td>
</tr>
</tbody>
</table>

