<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>激光位置计算工具</h1>

<h1>1.功能概述</h1>

<p>激光坐标计算工具主要利用链接的图像坐标、属性栏的激光标定结果以及补偿值，计算出输入的图像坐标在激光坐标系下对应的坐标值。</p>

<h1>2.应用场景</h1>

<p>在常见的激光切割、激光打标、激光焊接等应用场景中，均可使用此工具将图像坐标系中任意一点/多点转换到激光坐标系中。</p>

<h1>3.原理说明</h1>

<h3>图像坐标系 - 激光坐标系转换</h3>

<p>由“激光关联标定工具”中的原理描述可知，图像坐标系和激光坐标系会抽象为如图1所示的关系。</p>

<p><img src="media/GcLaserImage2LaserTool_3_1.png" alt="" /></p>

<p><imgnote>图1 图像 - 激光坐标系关系示意图</imgnote></p>

<p>其中两个坐标系的转换关系可以由如下公式表示。当完成激光标定计算后，此公式中的转换关系变为已知量，此时根据链接的图像坐标以及选择标定结果，可以计算出对应的激光坐标。</p>

<p><img src="media/GcLaserImage2LaserTool_3_2.png" alt="" /></p>

<h3>产品坐标系 - 激光坐标系转换</h3>

<p>在进行补偿值计算时，使用的坐标系为产品坐标系。如图2所示为产品坐标系和图像坐标系之间的关系图。两个坐标系类型一致（均为左手坐标系），正方向一致（向右向下顺时针），仅存在一个旋转角度和缩放比例关系。</p>

<p><img src="media/GcLaserImage2LaserTool_3_3.png" alt="" /></p>

<p><imgnote>图2 产品 - 图像坐标系关系示意图</imgnote></p>

<p>其中两个坐标系的转换关系可以由如下公式表示。根据链接的产品图像角度，可以得到第一个矩阵的参数；根据属性栏选择的激光标定结果，可以得到第二个矩阵的参数。从而此转换关系将产品坐标系下的补偿值转换为图像坐标系下的补偿值，再根据选择的激光标定结果，将图像坐标系下的补偿值，转换到激光坐标系下，从而得到最终的补偿值。</p>

<p><img src="media/GcLaserImage2LaserTool_3_4.png" alt="" /></p>

<h1>4. 使用向导</h1>

<p>工具的执行流程：配置输入 -> 属性栏参数设置 -> 执行计算。</p>

<h3>配置输入</h3>

<p>双击工具，在弹出的窗口中配置输入图像，如图3所示。</p>

<p><img src="media/GcLaserImage2LaserTool_4_1.png" alt="" /></p>

<p><imgnote>图3 配置输入示意图</imgnote></p>

<h3>属性栏参数设置</h3>

<p>点击工具，如图4所示，进行激光坐标计算工具的属性栏参数设置。</p>

<p><img src="media/GcLaserImage2LaserTool_4_2.png" alt="" /></p>

<p><imgnote>图4 属性栏参数设定示意图</imgnote></p>

<h4>是否输入多点</h4>

<p>当选择“否”时，在参数链中可以链接单点图像坐标，当选择“是”时，在参数链中需要链接图像坐标数组，并且此工具会一次性输出所有点的激光坐标值。</p>

<h4>输出产品角度</h4>

<p>1、当选择“是”，如果为单点，则输出栏有“产品激光角度”；如果为多点，则输出栏的激光坐标类型为vector<GcCoordPos>；并且激光坐标字符串中包含角度信息</p>

<p>2、当选择“否”，如果为单点，则输出栏没有“产品激光角度”；如果为多点，则输出栏的激光坐标类型为vector<sc2Vector>；并且激光坐标字符串中不包含角度信息。</p>

<p>此参数不影响激光坐标X和Y的值，仅决定是否在输出结果中显示角度信息。增加此参数的设置，主要是因为激光类应用场景中，有50%左右的项目不需要发送角度信息，为了使用户能够直接使用输出的结果而减少进一步的解析，为用户提供选择，当不需要输出角度信息时，选择否，则输出结果字符串中不包含角度信息，从而使用户能够只有使用此信息。</p>

<h4>数据内分隔符</h4>

<p>控制“激光坐标字符串”中每个激光坐标值内部的分隔符，比如激光坐标为【10，10，0.5】，当此分隔符设置为“,”时，则字符串结果为10,10,0.5；当此分割符设置为“;”时，则字符串结果为10;10;0.5。</p>

<h4>数据间分隔符</h4>

<p>控制“激光坐标字符串”中每个激光坐标值之间的分隔符，比如激光坐标数组大小为2，分别为【10，10，0.5】【20，20，0.5】，当此分隔符设置为“&amp;”时，则字符串结果为10,10,0.5&amp;20,20,0.5；当此分割符设置为“||”时，则字符串结果为10,10,0.5||20,20,0.5。</p>

<h4>小数位数</h4>

<p>控制“激光坐标字符串”中每个激光坐标值转换为字符串时保留的小数位数，范围为[0, 6]。比如此值为3时，激光坐标值【10，10，0.5】转换为字符串的结果为10.000,10.000,0.500。</p>

<h4>产品X方向补偿</h4>

<p>输出的激光坐标值在产品X方向的补偿，产品坐标系X方向的起始位置和图像坐标系X方向重合，即向右为正。其最终的方向由参数链中的“产品图像角度”确定。</p>

<h4>产品Y方向补偿</h4>

<p>输出的激光坐标值在产品Y方向的补偿，产品坐标系Y方向的起始位置和图像坐标系Y方向重合，即向下为正。其最终的方向由参数链中的“产品图像角度”确定（Y方向由X方向顺时针旋转90°得到）。</p>

<h4>产品角度补偿</h4>

<p>输出的激光坐标值在产品D方向的补偿，产品坐标系D方向的起始位置和图像坐标系D方向重合，即顺时针为正。</p>

<h1>5.常见问题</h1>

<h3>激光坐标偏差较大</h3>

<ol>
<li>确认是否链接了正确的图像坐标和正确选择激光标定结果。当选择单点模式时，如果图像坐标未链接，会采用其默认的数值，即[0, 0]作为图像坐标，从而导致结果偏差较大。</li>
<li>确认产品的补偿值是否正确。为了统一使用方式，均采用产品坐标系进行补偿，其中产品坐标系的含义、方向、和图像坐标系的关系等，均在前文中有详细的描述，根据产品坐标系的含义，确认补偿值的方向是否正确。</li>
<li>确认产品的图像角度是否正确。产品坐标系的构建，依赖于输入的产品角度，当产品的角度链接错误时，会导致构建的产品坐标系错误，从而计算处错误的激光坐标值。</li>
</ol>


<h3>上位机结果接收/解析失败</h3>

<p>确认是否配置了正确的数据内分隔符、数据间分隔符、小数位数等控制激光坐标字符串结果的参数，如果设置不正确，可能会导致上位机接收到结果后无法正确的解析。</p>

<h3>产品坐标系补偿说明</h3>

<p>为了进一步明确补偿时的使用方式，下面以实际应用场景为例，对产品产品坐标系进行说明。</p>

<ol>
<li>假设图5所示为某实际项目中的量测方式，以产品的L1和L2边为基准，测量目标点距离基准线的距离Dx和Dy，假设完成复检后发现Dx和Dy均需要补偿，则此时链接的图像角度为10°，补偿值为Dx和Dy与标准值之间的实际偏差。</li>
</ol>


<p><img src="media/GcLaserImage2LaserTool_5_1.png" alt="" /></p>

<p><imgnote>图5 产品坐标系场景1示意图</imgnote></p>

<ol>
<li>假设图6为令外某实际项目中的量测方式，以产品的L3和L4边为基准，测量目标点距离基准线的距离Dx和Dy，假设完成复检后发现Dx和Dy均需要补偿，则此时链接的图像角度为190°或-170°，补偿值为Dx和Dy与标准值之间的实际偏差。</li>
</ol>


<p><img src="media/GcLaserImage2LaserTool_5_2.png" alt="" /></p>

<p><imgnote>图6 产品坐标系场景2示意图</imgnote></p>

<h1>6.参数说明</h1>

<h3>输入参数</h3>

<table>
<thead>
<tr>
<th>参数名称 </th>
<th> 参数描述                                                                                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td> 选择标定结果      </td>
<td> 选择激光标定管理中已经标定结果</td>
</tr>
<tr>
<td> 是否输入多点      </td>
<td> 控制此工具进行单点/数组计算 </td>
</tr>
<tr>
<td> 输出产品角度      </td>
<td> 选择是则输出激光位置姿态数据。</td>
</tr>
<tr>
<td> 输入角度归一化      </td>
<td>  将输入的角度归一化，取值为[-90°,90°)、[-180°,180°)、[0°,180°)、[0°,360°)；比如归一化到-90~90°之间，输入的是92°，内部计算的时候会变成-88°。</td>
</tr>
<tr>
<td> 数据内分隔符 </td>
<td> 控制“激光坐标字符串”中每个激光坐标值内部的分隔符 </td>
</tr>
<tr>
<td> 数据间分隔符 </td>
<td> 控制“激光坐标字符串”中每个激光坐标值之间的分隔符 </td>
</tr>
<tr>
<td> 小数位数 </td>
<td> 控制“激光坐标字符串”中每个激光坐标值转换为字符串时保留的小数位数，范围为[0, 6] </td>
</tr>
<tr>
<td> 是否基于图像坐标系补偿 </td>
<td> 标识当前的补偿方式是基于图像坐标系还是基于激光坐标系。如果基于图像坐标系，则补偿值的正方向为向右向下；如果不基于图像坐标系，则需要用户手动设置补偿值轴方向，参考X轴方向和Y轴方向两个参数。 </td>
</tr>
<tr>
<td> X轴方向 </td>
<td> 补偿值计算时的X轴正方向，0表示向右为正，非0表示向左为正，仅在是否基于图像坐标系补偿为否时启用 </td>
</tr>
<tr>
<td> X轴方向 </td>
<td> 补偿值计算时的Y轴正方向，0表示向下为正，非0表示向上为正，仅在是否基于图像坐标系补偿为否时启用 </td>
</tr>
<tr>
<td> X方向补偿 </td>
<td> 输出的激光坐标值在产品X方向的补偿，产品坐标系X方向的起始位置和图像坐标系X方向重合，即向右为正 </td>
</tr>
<tr>
<td> Y方向补偿 </td>
<td> 输出的激光坐标值在产品Y方向的补偿，产品坐标系Y方向的起始位置和图像坐标系Y方向重合，即向下为正 </td>
</tr>
<tr>
<td> 角度补偿 </td>
<td> 输出的激光坐标值在产品D方向的补偿，产品坐标系D方向的起始位置和图像坐标系D方向重合，即顺时针为正 </td>
</tr>
<tr>
<td> 图像坐标单点 </td>
<td> 待计算的图像单点 </td>
</tr>
<tr>
<td> 图像坐标数组 </td>
<td> 待计算的图像点数组 </td>
</tr>
<tr>
<td> 产品图像角度 </td>
<td> 产品X方向的图像角度 </td>
</tr>
</tbody>
</table>


<h3>输出参数</h3>

<table>
<thead>
<tr>
<th> 参数名称       </th>
<th> 参数描述                                                                                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 图像坐标 </td>
<td>   用于计算的图像点数组 </td>
</tr>
<tr>
<td> 激光坐标X                                                </td>
<td> 单点计算时，输出的激光坐标X，类型为double   </td>
</tr>
<tr>
<td> 激光坐标Y </td>
<td> 单点计算时，输出的激光坐标Y，类型为double                                          </td>
</tr>
<tr>
<td> 激光坐标D </td>
<td> 单点计算时，输出的激光坐标D，类型为double                                            </td>
</tr>
<tr>
<td> 激光坐标 </td>
<td> 多点计算时，输出的激光坐标数组，类型为数组 </td>
</tr>
<tr>
<td> 激光坐标字符串 </td>
<td> 按照属性栏设置的相关参数，输出的激光坐标字符串结果 </td>
</tr>
<tr>
<td> 执行结果 </td>
<td> 工具执行结果。                                                                         </td>
</tr>
<tr>
<td> 执行时间 </td>
<td> 工具执行时间。                                                       </td>
</tr>
</tbody>
</table>


<h2>7.示例工程</h2>

<p>参见“\Samples\激光坐标计算工具.gvp”。</p>
