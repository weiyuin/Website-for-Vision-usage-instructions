<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>平面拟合工具</h1>

<h2>功能</h2>

<p>在3D测量中，往往需要对深度图像中检测区域内的三维空间点进行拟合获得一个最优平面，从而能够在这个基平面上进行投影、高度测量和体积测量等后续操作。平面拟合工具主要是根据若干个三维空间点计算得到三维平面的解析表达式。</p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称     </th>
<th> 参数描述                                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口     </td>
<td> 启用三维点集拟合                                             </td>
<td> 选择“是”，参数链中显示输入三维点集参数，并使用该三维点集进行平面拟合。 </td>
</tr>
<tr>
<td></td>
<td> 拟合方法     </td>
<td> 分为两种：面积和点。                                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 平面方向     </td>
<td> 分为两种：正像素空间和负像素空间。<img src="media/wps48.jpg" alt="img" />                                                                  </td>
</tr>
<tr>
<td></td>
<td> ROI类型      </td>
<td> 待检测区域，分为8种：整幅图像、矩形、仿射矩形、圆形、圆环、椭圆、多边形。                                                               </td>
</tr>
<tr>
<td></td>
<td> 启用掩模     </td>
<td> 是否启用掩模，选择“是”，显示掩模个数、掩膜序号、掩膜形状等参数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 掩模个数     </td>
<td> 设置启用的掩模个数，取值范围为 [1, 99]。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 掩膜序号     </td>
<td> 当前欲设置的掩膜索引。                                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 掩膜ROI类型 </td>
<td> 当前欲设置的掩膜形状，分为6种：矩形、仿射矩形、圆形、圆环、椭圆、多边形。                                                               </td>
</tr>
<tr>
<td></td>
<td> 二维点集     </td>
<td> 拟合方法为点时显示该参数，用于指定参与拟合平面的点。                                                                       </td>
</tr>
<tr>
<td></td>
<td> Z查询方法    </td>
<td> 拟合方法为点时显示该参数，分为三种：单个像素、邻域中值、邻域均值。<img src="media/wps49.jpg" alt="img" />                                                               </td>
</tr>
<tr>
<td></td>
<td> 邻域数量X、Y </td>
<td> Z查询方法为邻域中值和邻域均值时显示该参数，用于设置邻域X、Y尺寸大小，取值范围为[1, 25]。                                                               </td>
</tr>
<tr>
<td> 图像窗口     </td>
<td> 深度图像                                                     </td>
<td> 显示待检测的深度图像，显示为伪彩色图像。                     </td>
</tr>
<tr>
<td></td>
<td> 检测区域     </td>
<td> 在图像上显示待检测区域。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 掩模区域     </td>
<td> 在图像上显示待掩模区域。                                                                                                   </td>
</tr>
<tr>
<td> 数据链       </td>
<td> 深度图像                                                     </td>
<td> 输入待检测的深度图像。                                       </td>
</tr>
<tr>
<td></td>
<td> 输入三维点集 </td>
<td> 进行平面拟合的三维点集，仅在属性栏参数启用三维点集拟合选择“是”时有效。                                                               </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换 </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                                     </td>
</tr>
<tr>
<td> 高级界面         </td>
<td> 无        </td>
<td> 无  </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称       </th>
<th> 参数描述                                                                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口       </td>
<td> 深度图像                                     </td>
<td> 图像的长宽和像素大小，以及深度数据参数。 </td>
</tr>
<tr>
<td></td>
<td> 拟合平面       </td>
<td> 输出拟合平面结果，包括平面的法向量、偏移量、倾斜角、旋转角。<img src="media/wps51.jpg" alt="img" />                                           </td>
</tr>
<tr>
<td></td>
<td> 平面度         </td>
<td> 输出平面的平面度，即最大偏移-最小偏移，单位：mm。                                                      </td>
</tr>
<tr>
<td></td>
<td> 拟合误差       </td>
<td> 输出平面的拟合误差。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 平面拟合的点数 </td>
<td> 输出平面拟合中参与拟合的点数。                                                                         </td>
</tr>
<tr>
<td></td>
<td> 执行结果       </td>
<td> 工具执行结果。                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 执行时间       </td>
<td> 工具执行时间。                                                                                         </td>
</tr>
<tr>
<td> 图像窗口       </td>
<td> 输出图像                                                     </td>
<td> 显示检测的深度图像，显示为伪彩色图像。   </td>
</tr>
<tr>
<td></td>
<td> 数据链         </td>
<td> 同监视窗口参数，供后续工具使用。                                                                       </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>法向量、倾斜角、旋转角、偏移量</h3>

<p><strong>法向量：</strong>垂直于平面的向量<strong>N</strong>，表示平面在三维空间中的方向，如图1(a)所示。</p>

<p><strong>倾斜角：</strong>Z轴正方向按顺时针方向与平面法向量<strong>N</strong>的夹角<strong>φ</strong>，取值范围为：[0,π] ，如图1(b)所示。</p>

<p><strong>旋转角：</strong>X轴正方向按逆时针方向与法向量的投影向量<strong>N</strong><strong>0</strong>的夹角<strong>θ</strong>，取值范围为：[0, 2π) ，如图1(b)所示。</p>

<p><strong>偏移量：</strong>将原点移动到当前平面<strong>P</strong>上的距离偏移，若移动方向与法向量方向相同，偏移量为正；否则为负，如图1&copy;、(d)所示。</p>

<p><img src="media/wps53.jpg" alt="img" /></p>

<p><imgnote>图1 法向量、倾斜角、旋转角、偏移量</imgnote></p>

<p>平面拟合工具主要分以下三个步骤：</p>

<p><strong>Step 1 设置平面方向：</strong></p>

<p>在获取拟合的平面方程时，需要确定平面方向，即平面法向量的方向；平面方向共包含：正向像素空间Z和负向像素空间Z两种，其具体物理含义如下表所示。两种平面方向得到的平面法向量的数值是互为相反数的，因此，最终平面的法向量、偏移、倾斜和旋转等描述也就不同。</p>

<p><img src="media/wps54.jpg" alt="img" /></p>

<p><strong>Step 2 设置拟合方法和检测区域</strong></p>

<p>为了获取三维空间点数据需要设置拟合方法和检测区域。其中，拟合方法有：面积和点两种。基于不同的拟合方法，检测区域的设置也有所不同。</p>

<p>拟合方法为面积时，需要设置区域形状与掩膜，其中，区域形状支持圆、椭圆、多边形、矩形、仿射矩形或圆环段等六种检测区域设置，掩膜支持一定数量（1~99）的圆、椭圆、多边形、矩形、仿射矩形和圆环段等六种区域设置；此时，平面拟合使用的是区域形状内除去掩膜区域的三维空间点数据进行拟合。</p>

<p>拟合方法为点时，需要设置二维坐标与Z查询方法，其中，二维坐标是三维空间点对应在图像平面上的x、y位置坐标；设置Z查询方法主要是为了通过单个像素、邻域中值或邻域均值的查询方法获取三维空间点的z值，其中，邻域可以设置尺寸大小。此时，平面拟合使用的是二维坐标与Z查询方法得到的z值构成的三维空间点数据进行拟合。</p>

<p><strong>Step 3 执行拟合和输出结果</strong></p>

<p>在设置好平面方向、拟合方法和检测区域后，就可以执行平面拟合，输出的结果包括：平面的法向量、偏移量、倾斜角和旋转角，拟合的RMS误差，以及拟合平面所使用的三维点数目。</p>

<h2>注意</h2>

<p>无</p>

<h2>示例工程</h2>

<p>参见“\Samples\3D\深度图\3D测量工具.gvp”。</p>
