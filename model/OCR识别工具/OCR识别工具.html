<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>OCR识别工具</h1>

<h2>功能</h2>

<p>针对工业产品的字符识别需求，本工具可以对单一字符进行多场景训练来获得相应的字体模板并加入字符模板列表。最后通过实时图像与模板列表中的字符进行匹配，达到字符识别的目的。图1(a)即原图像和相应的识别区域，图1(b)即为本工具的字符识别结果。</p>

<p><img src="media/wps85.jpg" alt="img" />   <img src="media/wps86.jpg" alt="img" /></p>

<p><imgnote>(a) 原图与识别区域</imgnote> <imgnote>(b) OCR识别结果</imgnote></p>

<p><imgnote>图1 OCR识别工具应用示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称     </th>
<th> 参数描述                                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口     </td>
<td> 启用ROI      </td>
<td> 是否采用识别区域，若为否，则为全图匹配识别。                                                                               </td>
</tr>
<tr>
<td></td>
<td> 识别区域     </td>
<td> 显示实时图像上需要进行识别的矩形区域，仅在启用ROI为是时启用。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符极性     </td>
<td> 黑色字体还是白色字体，根据实际情况选择。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 二值化模式   </td>
<td> 图像质量较好时，优先使用全局自适应；图像质量较好且对效率要求较高时，优先使用固定阈值；图像质量较差(光照不均、噪声干扰、低对比度等)时，优先使用局部自适应。                                                               </td>
</tr>
<tr>
<td></td>
<td> 窗口高度     </td>
<td> 二值化模式为局部自适应时使用，取值范围为[3,10000]的整数。                                                                  </td>
</tr>
<tr>
<td></td>
<td> 窗口宽度     </td>
<td> 二值化模式为局部自适应时使用，二值化参数为邻域窗口宽度，参数值为[3,10000]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 固定阈值     </td>
<td> 二值化模式为固定阈值时使用，二值化参数为固定阈值大小，值域为[0,255]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 待分割行     </td>
<td> 对候选字符行进行选择。当选择指定行时，需要输入行编号，范围为[0,100]。默认行为高度最大行。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行编号       </td>
<td> 当选择指定行时，需要指定行编号。                                                                                           </td>
</tr>
<tr>
<td></td>
<td> 行膨胀尺寸   </td>
<td> 适用于点阵图像，将断开的行进行连接。行膨胀尺寸为[0,2147483647]的整数，默认值为0的整数。                                                     </td>
</tr>
<tr>
<td></td>
<td> 行筛选阈值   </td>
<td> 图像水平灰度投影曲线中大于行筛选阈值的区域被认为是可能的字符行，范围为[0,255]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行切割阈值   </td>
<td> 对已确定的字符行进行上下位置调整，防止字符如Q被过分割，参数范围为[-255,255]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行是否倾斜   </td>
<td> 当字符行不为水平时，需要开启此选项。行倾斜矫正搜索角度默认范围为[-45,45]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 角度最小值   </td>
<td> 设置行倾斜矫正搜索角度最小值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 角度最大值   </td>
<td> 设置行倾斜矫正搜索角度最大值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 自动分割     </td>
<td> 对字符分割是否开启自动参数。                                                                                               </td>
</tr>
<tr>
<td></td>
<td> 最大宽高比   </td>
<td> 设定分割字符的最大宽高比。当获得的字符宽高比大于该值时，将进行强制分割，范围为[0,100]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符膨胀尺寸 </td>
<td> 适用于点阵字符，将分割开的字符点左右连接。字符膨胀尺寸为[0,10000]的整数，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符筛选阈值 </td>
<td> 用于筛选候选字符。投影曲线中高于该阈值的区间即为候选字符区域。值域为[0,255]，默认值为20。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符连接尺寸 </td>
<td> 用于连接单个字符上下部分，比如字符i，j。值域为[0,10000]的整数，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 干扰强度阈值 </td>
<td> 用于筛选候选字符。投影曲线中投影值大于字符筛选阈值，并且高于干扰强度阈值的才是最终分割字符，否则不是。值域为[0,255]，默认值为10。                                                               </td>
</tr>
<tr>
<td></td>
<td> 干扰宽度阈值 </td>
<td> 用于筛选候选字符。投影曲线中投影值大于字符筛选阈值，并且宽度高于干扰宽度阈值的才是最终分割字符，否则不是；值域为[0,255]，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字体是否倾斜 </td>
<td> 当字体为倾斜字体时，需要设置此选项。斜体字矫正搜索角度默认范围为[-45,45]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 倾斜最小角度 </td>
<td> 设置斜体字矫正搜索角度最小值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 倾斜最大角度 </td>
<td> 设置斜体字矫正搜索角度最大值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 是否固定个数 </td>
<td> 识别的字符是否固定个数，默认为不固定个数。 当字符行中含有噪声时，可以选择启用待识别行字符个数参数来增强文本行识别结果的鲁棒性。                                                               </td>
</tr>
<tr>
<td></td>
<td> 识别字符个数 </td>
<td> 要识别固定个数的字符，需要设置此值。                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 识别字符串匹配分数下限 </td>
<td> 识别出的字符匹配分数，如果低于分数则运行失败。                                                              </td>
</tr>
<tr>
<td> 图像窗口     </td>
<td> 识别区域                                                     </td>
<td> 显示实时图像上参与OCR识别的矩形区域。与属性窗口中打开“启用ROI”后出现的“识别区域”是同一个参数。 </td>
</tr>
<tr>
<td> 数据链       </td>
<td> 输入图像                                                     </td>
<td> 用来实时识别的输入图像。                                     </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换 </td>
<td> 输入的定位二维线性变换结果，以根据其变换相应的识别区域                                                                     </td>
</tr>
<tr>
<td> 高级界面     </td>
<td> 执行识别                                                     </td>
<td> 根据加载的模板，对输入的图像进行字符识别，执行识别会有相应的错误码。 </td>
</tr>
<tr>
<td></td>
<td> 训练字库     </td>
<td> 对输入的图片进行训练，见训练步骤。                                                                 </td>
</tr>
<tr>
<td></td>
<td> 加载训练文件 </td>
<td> 加载.gmc文件。                                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 保存训练文件 </td>
<td> 将训练好的模板保存成.gmc文件。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 获取字符图像 </td>
<td> 训练时，需要对对话框里面的字符图像下的编辑框中输入对应字符标签，然进行训练。                                                               </td>
</tr>
<tr>
<td></td>
<td> 样本扩充     </td>
<td> 如果字库中样本偏少，可以对字库进行样本扩充，提供裁剪、旋转和灰度变化三种扩充方式。                                                               </td>
</tr>
<tr>
<td></td>
<td> 删除         </td>
<td> 删除字库里面的某个或者所有的字库。                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 筛选字符     </td>
<td> 对指定的某个字符进行筛选，方便查看。                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 字符极性     </td>
<td> 黑色字体还是白色字体，根据实际情况选择。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 二值化模式   </td>
<td> 图像质量较好时，优先使用全局自适应；图像质量较好且对效率要求较高时，优先使用固定阈值；图像质量较差(光照不均、噪声干扰、低对比度等)时，优先使用局部自适应。                                                               </td>
</tr>
<tr>
<td></td>
<td> 窗口高度     </td>
<td> 二值化模式为局部自适应时使用，取值范围为[3,10000]的整数。                                                                  </td>
</tr>
<tr>
<td></td>
<td> 窗口宽度     </td>
<td> 二值化模式为局部自适应时使用，二值化参数为邻域窗口宽度，参数值为[3,10000]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 固定阈值     </td>
<td> 二值化模式为固定阈值时使用，二值化参数为固定阈值大小，值域为[0,255]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 分割行     </td>
<td> 对候选字符行进行选择。当选择指定行时，需要输入行编号，范围为[0,100]。默认行为高度最大行。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行编号       </td>
<td> 当选择指定行时，需要指定行编号。                                                                                           </td>
</tr>
<tr>
<td></td>
<td> 行膨胀尺寸   </td>
<td> 适用于点阵图像，将断开的行进行连接。行膨胀尺寸为[0,10000]的整数，默认值为0的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行筛选阈值   </td>
<td> 图像水平灰度投影曲线中大于行筛选阈值的区域被认为是可能的字符行，范围为[0,255]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行切割阈值   </td>
<td> 对已确定的字符行进行上下位置调整，防止字符如Q被过分割，参数范围为[-255,255]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行是否倾斜   </td>
<td> 当字符行不为水平时，需要开启此选项。行倾斜矫正搜索角度默认范围为[-45,45]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 角度最小值   </td>
<td> 设置行倾斜矫正搜索角度最小值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 角度最大值   </td>
<td> 设置行倾斜矫正搜索角度最大值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 自动分割     </td>
<td> 对字符分割是否开启自动参数。                                                                                               </td>
</tr>
<tr>
<td></td>
<td> 最大宽高比   </td>
<td> 设定分割字符的最大宽高比。当获得的字符宽高比大于该值时，将进行强制分割，范围为[0,100]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符膨胀尺寸 </td>
<td> 适用于点阵字符，将分割开的字符点左右连接。字符膨胀尺寸为[0,10000]的整数，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符筛选阈值 </td>
<td> 用于筛选候选字符。投影曲线中高于该阈值的区间即为候选字符区域。值域为[0,255]，默认值为20。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字符连接尺寸 </td>
<td> 用于连接单个字符上下部分，比如字符i，j。值域为[0,10000]的整数，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 干扰强度阈值 </td>
<td> 用于筛选候选字符。投影曲线中投影值大于字符筛选阈值，并且高于干扰强度阈值的才是最终分割字符，否则不是。值域为[0,255]，默认值为10。                                                               </td>
</tr>
<tr>
<td></td>
<td> 干扰宽度阈值 </td>
<td> 用于筛选候选字符。投影曲线中投影值大于字符筛选阈值，并且宽度高于干扰宽度阈值的才是最终分割字符，否则不是；值域为[0,255]，默认值为0。                                                               </td>
</tr>
<tr>
<td></td>
<td> 字体是否倾斜 </td>
<td> 当字体为倾斜字体时，需要设置此选项。斜体字矫正搜索角度默认范围为[-45,45]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 倾斜最小角度 </td>
<td> 设置斜体字矫正搜索角度最小值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 倾斜最大角度 </td>
<td> 设置斜体字矫正搜索角度最大值。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 是否固定个数 </td>
<td> 识别的字符是否固定个数，默认为不固定个数。 当字符行中含有噪声时，可以选择启用待识别行字符个数参数来增强文本行识别结果的鲁棒性。                                                               </td>
</tr>
<tr>
<td></td>
<td> 识别字符个数 </td>
<td> 要识别固定个数的字符，需要设置此值。                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 字符极性     </td>
<td> 黑色字体还是白色字体，根据实际情况选择。                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 二值化模式   </td>
<td> 图像质量较好时，优先使用全局自适应；图像质量较好且对效率要求较高时，优先使用固定阈值；图像质量较差(光照不均、噪声干扰、低对比度等)时，优先使用局部自适应。                                                               </td>
</tr>
<tr>
<td></td>
<td> 窗口高度     </td>
<td> 二值化模式为局部自适应时使用，取值范围为[3,10000]的整数。                                                                  </td>
</tr>
<tr>
<td></td>
<td> 窗口宽度     </td>
<td> 二值化模式为局部自适应时使用，二值化参数为邻域窗口宽度，参数值为[3,10000]的整数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 固定阈值     </td>
<td> 二值化模式为固定阈值时使用，二值化参数为固定阈值大小，值域为[0,255]。                                                               </td>
</tr>
<tr>
<td></td>
<td> 待分割行     </td>
<td> 对候选字符行进行选择。当选择指定行时，需要输入行编号，范围为[0,100]。默认行为高度最大行。                                                               </td>
</tr>
<tr>
<td></td>
<td> 行号       </td>
<td> 当选择指定行时，需要指定行编号。                                                                                           </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称   </th>
<th> 参数描述                                                                                                         </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口   </td>
<td> 输入图像                                                     </td>
<td> 输入图像宽度、高度、像素大小。                     </td>
</tr>
<tr>
<td></td>
<td> 识别字符串 </td>
<td> 识别出来的字符串。        </td>
</tr>
<tr>
<td> </td>
<td> 识别字符串个数  </td>
<td> 识别的字符串个数。      </td>
</tr>
<tr>
<td></td>
<td> 识别结果   </td>
<td> 识别字符串结果，以字符串数组的形式给出。                                                                         </td>
</tr>
<tr>
<td></td>
<td> 识别字符串匹配分数 </td>
<td> 指字符串的匹配分数，以分数的数组形式给出，与字符串数组一一对应。                                                     </td>
</tr>
<tr>
<td></td>
<td> 执行结果   </td>
<td> 工具执行结果。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 执行时间   </td>
<td> 工具执行时间。                                                                                                   </td>
</tr>
<tr>
<td> 图像窗口   </td>
<td> 识别结果                                                     </td>
<td> 以包围识别出的单字符的矩形GUI标识出字符所在位置。  </td>
</tr>
<tr>
<td></td>
<td> 执行结果   </td>
<td> 显示工具执行结果，执行成功显示“OK”，执行失败显示“NG”，同监视窗口的执行结果参数。                                                     </td>
</tr>
<tr>
<td> 数据链       </td>
<td> 识别字符串个数      </td>
<td> 识别的字符串个数。      </td>
</tr>
<tr>
<td></td>
<td> 识别字符串 </td>
<td> 识别出来的字符串。        </td>
</tr>
<tr>
<td></td>
<td> 识别字符串匹配分数 </td>
<td> 识别出来的字符串匹配程度。      </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>错误码</h3>

<p>错误代码的含义，如下表：</p>

<p>表1 错误码含义</p>

<table>
<thead>
<tr>
<th> 错误码 </th>
<th> 含义                     </th>
</tr>
</thead>
<tbody>
<tr>
<td> 1      </td>
<td> 输入图像无效             </td>
</tr>
<tr>
<td> 2      </td>
<td> ROI区域无效              </td>
</tr>
<tr>
<td> 3      </td>
<td> 内存申请失败             </td>
</tr>
<tr>
<td> 4      </td>
<td> 无效的输入参数           </td>
</tr>
<tr>
<td> 5      </td>
<td> 二值化参数设置错误       </td>
</tr>
<tr>
<td> 6      </td>
<td> 二值化执行失败           </td>
</tr>
<tr>
<td> 7      </td>
<td> 行校正失败               </td>
</tr>
<tr>
<td> 8      </td>
<td> 获取分割行失败           </td>
</tr>
<tr>
<td> 9      </td>
<td> 字符分割失败             </td>
</tr>
<tr>
<td> 10     </td>
<td> 训练特征与勾选特征不匹配 </td>
</tr>
<tr>
<td> 11     </td>
<td> 执行失败                 </td>
</tr>
</tbody>
</table>


<h3>训练步骤</h3>

<p>方法一：</p>

<p>直接加载训练文件，主要包括自训练文件和预训练文件；预训练文件是.stc文件,见安装目录下面的Plugins\ocr文件夹；自训练文件是.gmc文件，可以通过开启“使用预训练文件”加载预训练文件 。见图2加载自/预训练文件图。</p>

<p><img src="media/wps92.jpg" alt="img" /></p>

<p><imgnote>(a) 使用自训练.stc文件</imgnote></p>

<p><img src="media/wps93.jpg" alt="img" /></p>

<p><imgnote>(b) 使用自训练.gmc文件</imgnote></p>

<p><imgnote>图2加载预训练文件图 </imgnote></p>

<p>方法二：</p>

<p>​     主要分为三步，第一步分割：将待识别的字符串分割成一个个字符，通过修改“参数设置里的参数”进行分割；第二步标定，使用“获取字符图像”对字符进行标定或者使用“获取标准字符图像”（由于此部分为字体库（字体库要与识别的字体一致），这部分不需要标定）；第三步执行训练。</p>

<p>(1) 执行识别，获取单字符分割图像：高级属性->执行识别，会出现都是问号的结果图像，见下图3执行识别结果图像</p>

<p><img src="media/wps94.png" alt="img" /></p>

<p><imgnote>图3 执行识别结果图像</imgnote></p>

<p>(2) 点击获取字符图像，在对话框字符图像下的编辑框中输入对应字符标签，点击确定，已打标签的字符将会添加到字库中：高级属性->字符训练->获取字符图像，标定字符（注意大小写），然后点击确定，完成标定。见图4标定字符。</p>

<p><img src="media/wps95.jpg" alt="img" /></p>

<p><imgnote>图4 标定字符</imgnote></p>

<p>(3) 勾选使用的训练特征，一般使用宽高比、灰度和外轮廓等特征即可，点击训练字库（如果字库中样本偏少，可以对字库进行样本扩充，提供旋转、倾斜、噪声、形态学、径向变形和局部变形六种扩充方式）：高级属性->训练字库，可以看到字库管理里面有很多标签，如果实际中不需要此字符的，可以删除某个标签，再次训练。一般进行训练的图像字符会比较多，不需要可删除，避免不必要的干扰。见图5训练字库执行识别的结果图。</p>

<p><img src="media/wps96.jpg" alt="img" /></p>

<p><imgnote>图5训练字库执行识别的结果图</imgnote></p>

<h2>注意</h2>

<p>1.目前此工具对于噪声干扰、字符宽度相差过大同时字符间距过小的文本行识别效果不佳</p>

<p>2.目前此工具对于相似字符的识别效果不佳（8和B、5和S）</p>

<p>3.支持部分字符粘连（不大于字符高度的15%）</p>

<p>4.支持低对比度（不低于10DN）</p>

<p>5.支持光照不均匀（对比度变化量不能超过10%）</p>

<p>6.一般不需要多次扩充，建议只对不易识别的单个字符进行扩充样本</p>

<p>7.训练特征梯度直方图和几何矩对噪声比较敏感，建议图像质量不好的时候不使用这两个特征进行训练</p>

<h2>示例工程</h2>

<p>参见“\Samples\读码工具.gvp”。</p>
