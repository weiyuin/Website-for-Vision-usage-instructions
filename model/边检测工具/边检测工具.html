<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>边检测工具</h1>

<h2>功能</h2>

<p>边检测工具针对直线和圆两种边缘类型，通过一组卡尺精确定位边缘特征，并拟合直线或者圆，根据卡尺边缘位置和拟合结果，检测直线或圆边缘的凹痕、凸痕、裂痕等类型偏差，给出偏差的数量、面积、尺寸等相关信息，完成边缘的连贯性检测。边检测示意如图1所示。</p>

<p><img src="media/wps136.jpg" alt="img" />     <img src="media/wps137.jpg" alt="img" /></p>

<p><imgnote>(a) 直线边缘偏差</imgnote> <imgnote>(b) 圆边缘偏差</imgnote></p>

<p><imgnote>图1 边检测示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称         </th>
<th> 参数描述                                                                                                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口         </td>
<td> 边缘极性                                                     </td>
<td> 边缘极性是指图像边缘灰度级的过渡形式，分为3种：任意极性、亮到暗和暗到亮。<a href="#_%E8%BE%B9%E7%BC%98%E6%A8%A1%E5%BC%8F"><img src="media/wps139.jpg" alt="img" /></a> </td>
</tr>
<tr>
<td></td>
<td> 对比度阈值       </td>
<td> 卡尺工具默认只采用对比度评价分数，即按照边缘信号的强度来评分，输出边缘最强的点。对比度阈值的取值范围是0~255。                                                               </td>
</tr>
<tr>
<td></td>
<td> 滤波器半宽       </td>
<td> 卡尺工具在直线（圆）的拟合过程中，会对图像进行滤波处理以增强边缘信息，其中滤波半宽是可调的，滤波半宽默认值为1。                                                               </td>
</tr>
<tr>
<td></td>
<td> 第一边缘         </td>
<td> 选择“是”，则启用第一边缘准则以获取最佳边缘。<a href="#_%E8%8E%B7%E5%8F%96%E6%9C%80%E4%BD%B3%E8%BE%B9%E7%BC%98"><img src="media/wps140.jpg" alt="img" /></a>                                                               </td>
</tr>
<tr>
<td></td>
<td> 最强边缘         </td>
<td> 选择“是”，则启用最强边缘准则以获取最佳边缘。                                                                               </td>
</tr>
<tr>
<td></td>
<td> 分数阈值         </td>
<td> 对所有边缘进行评分，会得到一个评价分数，分数阈值是边缘评分的阈值，高于该阈值且评分最高的边缘被选为拟合边缘和候选边缘。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否过滤异常值   </td>
<td> 过滤异常值的目的是对拟合边缘（点）进行筛选，以降低偏差边缘给拟合带来的干扰。筛选的原则是基于拟合点在卡尺搜索方向上到拟合直线（圆）的距离，过滤距离较大的点，根据设定的距离阈值对拟合边缘进行更新。                                                               </td>
</tr>
<tr>
<td></td>
<td> 过滤距离阈值     </td>
<td> 过滤掉到拟合直线（圆）的距离大于过滤阈值的拟合点。以直线边缘为例，在卡尺搜索方向上，若拟合点到拟合线的距离大于过滤距离阈值，则去除该拟合点，剔除掉所有距离过大的拟合点后，再由剩下的其它拟合点重新拟合直线。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否重新评分     </td>
<td> 重新评分的目的是对候选边缘进行更新，以降低干扰边缘带来的误判。重新评分添加边缘到拟合线的距离作为新的评价指标，对每个卡尺的所有边缘进行评分，距离越小，分数越高，分数取值范围为[0,100]。重新评分后，将“重新评分”准则代替“第一边缘”准则（若有），再与“最强边缘”准则（若有）作几何评价，得到最终的评价分数，然后在每个卡尺内，选取分数最高的作为候选边缘。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否重新拟合     </td>
<td> 重新拟合是在重新评分的基础上更新拟合边缘：先将重新评分得到的候选边缘作为拟合边缘，若需要过滤异常值，则与过滤异常值拟合过程一样，先拟合直线（圆），根据拟合边缘到拟合线的距离剔除距离异常的拟合边缘，更新拟合边缘。                                                               </td>
</tr>
<tr>
<td></td>
<td> 最小缺陷距离     </td>
<td> 缺陷边缘到拟合线的最小距离，小于该距离，则不认为是缺陷。                                                                   </td>
</tr>
<tr>
<td></td>
<td> 最大缺陷距离     </td>
<td> 缺陷边缘到拟合线的最大距离，大于该距离，则不认为是缺陷。                                                                   </td>
</tr>
<tr>
<td></td>
<td> 是否启动尺寸     </td>
<td> 选择“是”，则显示最小尺寸和最大尺寸参数，并根据最小尺寸和最大尺寸对缺陷结果进行过滤。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否启动面积     </td>
<td> 选择“是”，则显示最小面积和最大面积参数，并根据最小面积和最大面积对缺陷结果进行过滤。                                                               </td>
</tr>
<tr>
<td></td>
<td> 缺陷排序规则     </td>
<td> 排序规则分为3种：尺寸、面积和位置，根据选择的规则对缺陷结果进行排序。其中，尺寸和面积为从大到小排序，位置为沿着卡尺方向从左到右排序。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否过滤左侧缺陷 </td>
<td> 沿着卡尺方向，位于拟合线左侧的缺陷为左侧缺陷。该参数选择“是”，则在缺陷结果中将左侧缺陷过滤掉。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否过滤右侧缺陷 </td>
<td> 沿着卡尺方向，位于拟合线右侧的缺陷为右侧缺陷。该参数选择“是”，则在缺陷结果中将右侧缺陷过滤掉。                                                               </td>
</tr>
<tr>
<td></td>
<td> 最大缺陷数目     </td>
<td> 缺陷结果数目的最大值，若缺陷数目超过该值，则按照缺陷排序规则，过滤掉缺陷结果中排在后位的缺陷。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否检测间距     </td>
<td> 选择“是”，则同时检测缺陷和间距，并显示最大间距数目、最小间距、最大间距、是否会略端点间距、间距排序规则等参数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 最大间距数目     </td>
<td> 间距结果数目的最大值，若间距数目超过该值，则按照间距排序规则，过滤掉间距结果中排在后位的间距。                                                               </td>
</tr>
<tr>
<td></td>
<td> 最小间距         </td>
<td> 卡尺边缘到拟合线的最小距离，小于该距离，则不认为是间距。                                                                   </td>
</tr>
<tr>
<td></td>
<td> 最大间距         </td>
<td> 卡尺边缘到拟合线的最大距离，大于该距离，则不认为是间距。                                                                   </td>
</tr>
<tr>
<td></td>
<td> 是否忽略端点间距 </td>
<td> 选择“是”，则忽略掉端点间距。端点间距是在检测区域范围内位于两端的间距。                                                               </td>
</tr>
<tr>
<td></td>
<td> 间距排序规则     </td>
<td> 排序规则分为3种：尺寸、面积和位置，根据选择的规则对间距结果进行排序。其中，尺寸和面积为从大到小排序，位置为沿着卡尺方向从左到右排序。                                                               </td>
</tr>
<tr>
<td></td>
<td> 是否显示拟合结果 </td>
<td> 选择“是”，则显示图像检测区域内的拟合直线（圆）。                                                                           </td>
</tr>
<tr>
<td></td>
<td> 是否显示缺陷区域 </td>
<td> 选择“是”，则显示图像检测区域内的缺陷。                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 是否显示间距区域 </td>
<td> 选择“是”，则显示图像检测区域内的间距。                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 检测区域         </td>
<td> 设置检测区域位置及尺寸。Rotation表示检测区域的旋转角度，Bend表示检测区域的弯曲度，通过调整可切换直线与圆检测区域。                                                               </td>
</tr>
<tr>
<td></td>
<td> 缺陷结果数目上限 </td>
<td> 对检测出的缺陷数目进行判定，如果缺陷数目超过此上限设置，工具执行结果失败。参数的取值范围为[0,100000]，可设置为&mdash;&mdash;，此参数不生效。 </td>
</tr>
<tr>
<td></td>
<td> 间距结果数目上限 </td>
<td> 对检测出的间距数目进行判定，如果缺陷数目超过此上限设置，工具执行结果失败。参数的取值范围为[0,100000]，可设置为&mdash;&mdash;，此参数不生效。 </td>
</tr>
<tr>
<td> 图像窗口         </td>
<td> 检测区域                                                     </td>
<td> 图像中参与检测的矩形或环形区域。                             </td>
</tr>
<tr>
<td></td>
<td> 输入图像         </td>
<td> 显示待检测的图像。                                                                                                         </td>
</tr>
<tr>
<td> 数据链           </td>
<td> 输入图像                                                     </td>
<td> 输入图像宽度、高度、像素大小，同图像窗口的输入图像参数。     </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换     </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 高级界面         </td>
<td> 无                                                                                                                         </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称       </th>
<th> 参数描述                                                                                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口       </td>
<td> 输入图像                                                     </td>
<td> 输出图像宽度、高度、像素大小。                             </td>
</tr>
<tr>
<td></td>
<td> 缺陷结果       </td>
<td> 缺陷的位置、尺寸、面积等信息。                                                                                           </td>
</tr>
<tr>
<td></td>
<td> 间距结果       </td>
<td> 间距的位置、尺寸、面积等信息。                                                                                           </td>
</tr>
<tr>
<td></td>
<td> 缺陷结果数目   </td>
<td> 过滤后的缺陷结果总数目。                                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 间距结果数目   </td>
<td> 过滤后的间距结果总数目。                                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 执行结果       </td>
<td> 工具执行结果。                                                                                                           </td>
</tr>
<tr>
<td></td>
<td> 执行时间       </td>
<td> 工具执行时间。                                                                                                           </td>
</tr>
<tr>
<td> 图像窗口       </td>
<td> 输入图像                                                     </td>
<td> 显示工具执行结果图像，同监视窗口的输入图像参数。           </td>
</tr>
<tr>
<td></td>
<td> 拟合直线（圆） </td>
<td> 属性窗口的是否显示拟合结果参数选择是时，显示图像检测区域内的拟合直线（圆）。                                                             </td>
</tr>
<tr>
<td></td>
<td> 缺陷结果       </td>
<td> 属性窗口的是否显示缺陷结果参数选择是时，显示图像检测区域内的缺陷结果。                                                             </td>
</tr>
<tr>
<td></td>
<td> 间距结果       </td>
<td> 属性窗口的是否显示间距结果参数选择是时，显示图像检测区域内的间距结果。                                                             </td>
</tr>
<tr>
<td></td>
<td> 执行结果       </td>
<td> 显示工具执行结果，执行成功显示“OK”，执行失败显示“NG”，同监视窗口的执行结果参数。                                                             </td>
</tr>
<tr>
<td></td>
<td> 缺陷起始点 </td>
<td> 输出所有缺陷的起始点。 </td>
</tr>
<tr>
<td></td>
<td> 缺陷终止点 </td>
<td> 输出所有缺陷的终止点。 </td>
</tr>
<tr>
<td></td>
<td> 间距起始点 </td>
<td> 输出所有间距的起始点。 </td>
</tr>
<tr>
<td></td>
<td> 间距终止点 </td>
<td> 输出所有间距的终止点。 </td>
</tr>
<tr>
<td>数据链</td>
<td> 缺陷结果       </td>
<td> 输出缺陷的位置、尺寸、面积等信息，供后序工具使用，同监视窗口的缺陷结果参数。                                                             </td>
</tr>
<tr>
<td></td>
<td> 间距结果       </td>
<td> 输出间距的位置、尺寸、面积等信息，供后序工具使用，同监视窗口的间距结果参数。                                                             </td>
</tr>
<tr>
<td></td>
<td> 缺陷起始点 </td>
<td> 输出所有缺陷的起始点。                           </td>
</tr>
<tr>
<td></td>
<td> 缺陷终止点 </td>
<td> 输出所有缺陷的终止点。                                               </td>
</tr>
<tr>
<td></td>
<td> 间距起始点     </td>
<td> 输出所有间距的起始点。                                       </td>
</tr>
<tr>
<td></td>
<td> 间距终止点 </td>
<td> 输出所有间距的终止点。 </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>缺陷有左右之分</h3>

<p><img src="media/wps143.jpg" alt="img" /></p>

<h3>边缘极性</h3>

<p>卡尺的边缘极性是根据图像边缘的灰度级过渡形式来确定的。如图2所示，沿着卡尺Y轴正方向(红色箭头所指的方向)，图像边缘的灰度级过渡形式如果是从亮到暗，则边缘极性选择亮到暗，反之选择暗到亮，如果图像边缘的灰度级过渡形式不确定时选择任意极性。</p>

<p><img src="media/wps144.jpg" alt="img" />     <img src="media/wps145.jpg" alt="img" /></p>

<p><imgnote>(a) 亮到暗</imgnote> <imgnote>(b) 暗到亮</imgnote></p>

<p><imgnote>图2 边缘极性示意图</imgnote></p>

<h3>基本概念</h3>

<p>偏差的尺寸、面积、区域、位置等物理量的概念与计算方式如下表所示。</p>

<table>
<thead>
<tr>
<th> 偏差类型 </th>
<th> 示意图                                             </th>
<th> 说明                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 直线缺陷           </td>
<td> <img src="media/wps146.png" alt="img" /> </td>
<td> 尺寸：左右缺陷卡尺与拟合线交点距离；面积：缺陷卡尺候选点到拟合线距离（卡尺搜索方向）的均值与尺寸的乘积；区域：仿射矩形，图中红色区域所示；位置： 缺陷区域右下角 </td>
</tr>
<tr>
<td> 圆缺陷             </td>
<td> <img src="media/wps147.png" alt="img" /> </td>
<td> 尺寸：左右缺陷卡尺与拟合圆交点所在弧线段距离；面积：缺陷卡尺候选点到拟合圆距离（卡尺搜索方向）的均值与尺寸的乘积；区域：扇形，图中红色区域所示；位置：扇形区域右下角 </td>
</tr>
<tr>
<td> 直线间距           </td>
<td> <img src="media/wps148.png" alt="img" /> </td>
<td> 尺寸：左右间距卡尺与拟合线交点距离；面积：卡尺搜索长度与尺寸的乘积；区域：仿射矩形，图中红色区域所示；位置：缺陷区域右下角 </td>
</tr>
<tr>
<td> 圆间距             </td>
<td> <img src="media/wps149.png" alt="img" /> </td>
<td> 尺寸：左右间距卡尺与拟合圆交点所在弧线段距离；面积：卡尺搜索长度与尺寸的乘积；区域：扇形，图中红色区域所示；位置：扇形区域右下角 </td>
</tr>
</tbody>
</table>


<h3>获取最佳边缘</h3>

<p>依次对单个卡尺的所有边缘进行评分，获取评价分数最高的边缘，作为拟合边缘和候选边缘。边检测工具提供“第一条边缘”、“最强边缘”两个准则来评价边缘。两个准则至少选取一个，若两个准则同时采用，取两个准则评价分数的几何平均作为评价分数。</p>

<p>其中，“第一条边缘”准则以中心偏移（即边缘位置相对于投影区域中心位置的偏移，其值可正可负）作为评价指标，中心偏移值越小分数越高；“最强边缘”准则以边缘幅值（即边缘两侧像素灰度差）作为评价指标，边缘幅值越大分数越高。分数值域范围为[0,100]。</p>

<h2>注意</h2>

<ul>
<li>边检测工具对偏差确认为缺陷还是间距，与检测区域卡尺的搜索长度有很大关系，如图3所示，在实际使用中应注意检测区域大小应适当。</li>
</ul>


<p><img src="media/wps151.jpg" alt="img" /> <img src="media/wps152.jpg" alt="img" /></p>

<p><imgnote>(a) 确认为间距</imgnote></p>

<p><img src="media/wps153.jpg" alt="img" /> <img src="media/wps154.jpg" alt="img" /></p>

<p><imgnote>(b) 确认为缺陷</imgnote></p>

<p><imgnote>图3 偏差确认</imgnote></p>

<ul>
<li><p>边检测工具需要配合数组解析工具和边特征检测工具结果解析使用。数组解析工具的数据类型属性选择“EdgeDeviation”就可以获取边检测工具的缺陷结果和间距结果输出，再利用边特征检测工具结果解析可以数组解析工具的输出结果进行解析。</p></li>
<li><p>边检测工具的缺陷结果数据和间距结果数目可以直接获取，类型为int。</p></li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\边特征检测工具结果解析.gvp”。</p>
