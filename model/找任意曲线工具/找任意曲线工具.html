<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>找任意曲线工具</h1>

<h2>功能</h2>

<p>定位是机器视觉中重要的应用之一，常借助于目标物体中的特定几何特征进行定位，如线、角、圆等几何特征。在某些应用定位特征不是固定的线或者圆特征，而是由任意多个线段和圆弧段组合而成的曲线，找任意曲线工具主要功能就是解决线圆同时存在时的情况。同时，找任意曲线工具还具备以下功能：</p>

<ul>
<li><p>卡尺是否按分数排序，卡尺结果是否反向排序；</p></li>
<li><p>可分段控制是否启用，可分段控制是否中心点最强；</p></li>
<li><p>可设置卡尺探测结果偏移；</p></li>
<li><p>相邻结果曲线段之间可自动进行端点处理。</p></li>
</ul>


<p><img src="media/wps17.jpg" alt="img" />  <img src="media/wps18.jpg" alt="img" /></p>

<p><imgnote>(a) 输入图像</imgnote> <imgnote>(b) 找任意曲线结果</imgnote></p>

<p><imgnote>图1 找任意曲线工具</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称           </th>
<th> 参数描述                                                                                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口           </td>
<td> 边缘模式                                                     </td>
<td> 卡尺工具的边缘模式有2种，单边缘和双边缘。                </td>
</tr>
<tr>
<td></td>
<td> 探测点偏移         </td>
<td> 控制探测点是否产生偏移。选择“是”，显示根据卡尺偏移参数。                                                               </td>
</tr>
<tr>
<td></td>
<td> 根据卡尺偏移       </td>
<td> 探测点的偏移方式，选择“是”，根据卡尺方向偏移；选择“否”，根据拟合曲线方向偏移。                                                           </td>
</tr>
<tr>
<td></td>
<td> 曲线拟合           </td>
<td> 探测点是否进行拟合。选择“是”，显示拟合方法、局外点比例、端点处理、闭合轮廓、是否显示卡尺探测点、<br />局外点偏移量和是否修正局外点参数。                                                     </td>
</tr>
<tr>
<td></td>
<td> 拟合方法           </td>
<td> 指考虑局外点的曲线拟合方法，即拟合工具允许用户设置拟合数据点中的局外点个数。<br />分为4种，Combination(全组合)、Ransac(随机抽样)、Robust(权重)和RansacRobust(随机抽样权重)。<br />拟合时间：Combination>RansacRobust>Ransac> Robust。拟合结果的可信度：Combination>RansacRobust> Robust> Ransac。                                               </td>
</tr>
<tr>
<td></td>
<td> 仅使用滤波 </td>
<td> 当图像拟合出来的曲线与实际轮廓偏差较大时，用户可勾选仅使用滤波，从而避免对探测点的错误修正。<br />不开启仅使用滤波时：首先根据拟合曲线修正距离曲线较远的探测点，然后再对这些点进行邻域滤波，以得到平滑的轮廓点。<br />启用仅使用滤波时：不会根据拟合曲线对距离曲线较远的点进行修正，仅对这些点进行邻域平滑滤波。 </td>
</tr>
<tr>
<td></td>
<td> 局外点比例         </td>
<td> 局外点就是偏离曲线较远的点。局外点比例即不参与直线拟合的点的比例，取值范围是[0,1)。                                                      </td>
</tr>
<tr>
<td></td>
<td> 端点处理           </td>
<td> 控制是否进行端点处理，端点处理是对相邻两卡尺端点处不合理探测点进行删除操作的处理。                                                           </td>
</tr>
<tr>
<td></td>
<td> 闭合轮廓           </td>
<td> 控制是否对有闭合趋势的曲线进行轮廓闭合操作。                                                                           </td>
</tr>
<tr>
<td></td>
<td> 是否显示卡尺探测点 </td>
<td> 控制在图像窗口是否显示剔除超出局外点偏移量的探测点或者经过修正后的所有卡尺探测点。                                                           </td>
</tr>
<tr>
<td></td>
<td> 局外点偏移量       </td>
<td> 探测点偏离拟合直线或圆而不被剔除或修正的最大距离。                                                                     </td>
</tr>
<tr>
<td></td>
<td> 是否修正局外点     </td>
<td> 控制是否对偏离拟合直线或圆的探测点进行修正。                                                                           </td>
</tr>
<tr>
<td></td>
<td> 显示探测点         </td>
<td> 显示卡尺所有的探测点，没有进过剔除或修正操作。                                                                         </td>
</tr>
<tr>
<td></td>
<td> 显示曲线           </td>
<td> 控制是否显示拟合曲线。                                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 显示质心           </td>
<td> 控制是否显示质心。<img src="media/wps20.jpg" alt="img" />                                                                              </td>
</tr>
<tr>
<td></td>
<td> 显示外接矩形       </td>
<td> 控制是否显示外接矩形。外接矩形是指有效结果点的外接矩形，若用户未开启拟合，卡尺探测点为有效结果点；<br />否则，参与拟合的卡尺探测点为有效结果点。<img src="media/wps21.jpg" alt="img" />                                                     </td>
</tr>
<tr>
<td></td>
<td> 显示探测点连线 </td>
<td> 控制是否显示探测点的连接线段。 </td>
</tr>
<tr>
<td></td>
<td> 显示探测点偏移     </td>
<td> 控制是否显示经过偏移的探测点。                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 是否插值计算       </td>
<td> 控制是否进行插值计算，插值计算是指在相邻的两个探测点间通过插值的方法增加一个探测点。                                                           </td>
</tr>
<tr>
<td></td>
<td> 拟合仿真探测点 </td>
<td> 控制是否计算拟合结果的仿真坐标点，仿真坐标点通过等分拟合结果得到采样点集合 </td>
</tr>
<tr>
<td></td>
<td> 拟合仿真探测点步长 </td>
<td> 当开启”拟合仿真探测点“时，可设置获取探测点的等分步长。步长越短，仿真探测点越密集；反之，步长越长，仿真探测点越稀疏。 </td>
</tr>
<tr>
<td> 图像窗口           </td>
<td> 输入图像                                                     </td>
<td> 显示待检测的图像。                                       </td>
</tr>
<tr>
<td></td>
<td> 找曲线GUI          </td>
<td> 找任意曲线的卡尺工具。<img src="media/wps22.jpg" alt="img" />                                                                          </td>
</tr>
<tr>
<td> 数据链             </td>
<td> 输入图像                                                     </td>
<td> 输入图像宽度、高度、像素大小，同图像窗口的输入图像参数。 </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换       </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                                 </td>
</tr>
<tr>
<td> 高级界面           </td>
<td> 无        </td>
<td> 无   </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称          </th>
<th> 参数描述                                                                                                               </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口          </td>
<td> 输入图像                                                     </td>
<td> 输出图像宽度、高度、像素大小。                           </td>
</tr>
<tr>
<td></td>
<td> 探测点个数        </td>
<td> 卡尺所探测到的轮廓点个数。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 全部探测点 </td>
<td> 输出所有探测点坐标数组 </td>
</tr>
<tr>
<td></td>
<td> 拟合探测点 </td>
<td> 输出用于拟合的探测点坐标数组 </td>
</tr>
<tr>
<td></td>
<td> 卡尺探测点位置 </td>
<td> 输出卡尺探测点的位置坐标。 </td>
</tr>
<tr>
<td></td>
<td> 拟合线段位置 </td>
<td> 输出拟合线段的第一个和最后一个点的坐标值。 </td>
</tr>
<tr>
<td></td>
<td> 拟合曲线位置 </td>
<td> 输出拟合圆弧圆心、半径和角度。 </td>
</tr>
<tr>
<td></td>
<td> 探测质心          </td>
<td> 输出质心X、Y坐标。                                                                                                     </td>
</tr>
<tr>
<td></td>
<td> 探测外接矩形      </td>
<td> 输出外接矩形的左上角坐标、宽度和高度。                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 轮廓边缘类型       </td>
<td> 输出第一段和最后一段卡尺对应的轮廓特征和轮廓点数。           </td>
</tr>
<tr>
<td></td>
<td> 拟合探测点个数     </td>
<td> 筛选出用于拟合的的轮廓点个数。                               </td>
</tr>
<tr>
<td></td>
<td> 全部探测点 </td>
<td> 检测到的全部卡尺探测点。 </td>
</tr>
<tr>
<td></td>
<td> 拟合探测点 </td>
<td> 检测到的全部卡尺探测点的拟合结果。 </td>
</tr>
<tr>
<td></td>
<td> 轮廓边缘类型 </td>
<td> 输出第一段和最后一段卡尺对应的轮廓特征和轮廓点数，供后序轮廓拼接工具使用，同监视窗口的轮廓边缘类型参数。 </td>
</tr>
<tr>
<td></td>
<td> 拟合探测点个数 </td>
<td> 检测到的全部卡尺探测点的拟合结果的个数。 </td>
</tr>
<tr>
<td></td>
<td> 执行结果          </td>
<td> 工具执行结果。                                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 执行时间          </td>
<td> 工具执行时间。                                                                                                         </td>
</tr>
<tr>
<td> 图像窗口          </td>
<td> 输入图像                                                     </td>
<td> 显示工具执行结果图像，同监视窗口的输出图像参数。         </td>
</tr>
<tr>
<td></td>
<td> 卡尺探测点        </td>
<td> 显示卡尺探测点。                                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 探测中心GUI       </td>
<td> 显示图像的质心。                                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 探测外接矩形GUI   </td>
<td> 显示有效结果点的外接矩形。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 探测点GUI         </td>
<td> 显示探测到的轮廓点。                                                                                                   </td>
</tr>
<tr>
<td></td>
<td> 拟合曲线          </td>
<td> 显示拟合圆弧。                                                                                                         </td>
</tr>
<tr>
<td></td>
<td> 拟合线段          </td>
<td> 显示拟合的线段。                                                                                                       </td>
</tr>
<tr>
<td></td>
<td> 探测点连线        </td>
<td> 显示相邻两探测点间的连线。                                                                                             </td>
</tr>
<tr>
<td></td>
<td> 偏移前探测点      </td>
<td> 探测点偏移开启时，显示偏移前的探测点。                                                                                 </td>
</tr>
<tr>
<td></td>
<td> 执行结果          </td>
<td> 显示工具执行结果，执行成功显示“OK”，执行失败显示“NG”，同监视窗口的执行结果参数。                                                           </td>
</tr>
<tr>
<td> 数据链            </td>
<td> 探测中心GUI        </td>
<td> 输出图像质心，供后序工具使用，同图像窗口的探测中心GUI参数。  </td>
</tr>
<tr>
<td>  </td>
<td> 探测外接矩形GUI </td>
<td> 输出有效结果点的外接矩形，供后序工具使用，同图像窗口的探测外接矩形GUI参数。 </td>
</tr>
<tr>
<td>  </td>
<td> 全部探测点 </td>
<td> 输出全部探测点，供后序工具使用。 </td>
</tr>
<tr>
<td>  </td>
<td> 拟合探测点 </td>
<td> 输出用于曲线拟合的探测点，供后序工具使用。 </td>
</tr>
<tr>
<td></td>
<td> 卡尺探测点        </td>
<td> 输出卡尺探测点，供后序工具使用，同图像窗口的卡尺探测点参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 卡尺探测点位置    </td>
<td> 输出卡尺探测点位置，供后序工具使用，同监视窗口的卡尺探测点位置参数。                                                           </td>
</tr>
<tr>
<td></td>
<td> 拟合曲线 </td>
<td> 输出拟合圆弧段，供后序工具使用，同图像窗口的拟合曲线参数。 </td>
</tr>
<tr>
<td></td>
<td> 拟合线段 </td>
<td> 输出拟合线段，供后序工具使用，同图像窗口的拟合线段参数。 </td>
</tr>
<tr>
<td></td>
<td> 探测点连线         </td>
<td> 输出相邻两探测点间的线段，供后序工具使用，同图像窗口的探测点连线参数。 </td>
</tr>
<tr>
<td></td>
<td> 偏移前的探测点     </td>
<td> 输出卡尺偏移前的探测点，供后序工具使用，同图像窗口的偏移前的探测点参数。 </td>
</tr>
<tr>
<td></td>
<td> 探测点位置         </td>
<td> 输出探测到的轮廓点，供后序工具使用，同监视窗口的探测点位置参数。 </td>
</tr>
<tr>
<td></td>
<td> 拟合线段位置       </td>
<td> 输出拟合线段位置，供后序工具使用，同监视窗口的拟合线段位置参数。 </td>
</tr>
<tr>
<td></td>
<td> 拟合曲线位置       </td>
<td> 输出拟合圆弧段，供后序工具使用，同监视窗口的拟合曲线位置参数。 </td>
</tr>
<tr>
<td></td>
<td> 探测质心           </td>
<td> 输出图像质心，供后序工具使用，同监视窗口的探测中心参数。     </td>
</tr>
<tr>
<td></td>
<td> 拟合仿真探测点结果 </td>
<td> 输出用于拟合仿真的探测点结果。                               </td>
</tr>
<tr>
<td></td>
<td> 轮廓边缘类型       </td>
<td> 输出第一段和最后一段卡尺对应的轮廓特征和轮廓点数，供后序轮廓拼接工具使用，同监视窗口的轮廓边缘类型参数。 </td>
</tr>
<tr>
<td></td>
<td> 插值后探测点位置   </td>
<td> 输出经过插值计算后的探测点，供后序工具使用，同监视窗口的插值后探测点位置参数。 </td>
</tr>
<tr>
<td></td>
<td> 全部探测点 </td>
<td> 检测到的全部卡尺探测点。 </td>
</tr>
<tr>
<td></td>
<td> 拟合探测点 </td>
<td> 检测到的全部卡尺探测点的拟合结果。 </td>
</tr>
<tr>
<td></td>
<td> 拟合仿真探测点结果 </td>
<td> 检测到的全部仿真探测点的拟合结果。 </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<p><strong>结果质心</strong></p>

<p>如图2（b）所示，结果质心定义为有效结果点坐标的算术平均值。</p>

<p><strong>结果外接矩形</strong></p>

<p>如图2（b）所示，结果外接矩形定义为有效结果点的外接矩形。</p>

<p><img src="media/wps25.jpg" alt="img" /><img src="media/wps26.jpg" alt="img" /></p>

<p><imgnote>(a) 输入图像</imgnote>  <imgnote>(b) 质心和外接矩形</imgnote></p>

<p><imgnote>图2 找任意曲线示例</imgnote></p>

<p><strong>找曲线GUI</strong></p>

<p>找曲线GUI由多段卡尺组成，可在找任意曲线GUI左键双击(右键Edit Param)对话框设置每段卡尺参数，如图3所示。包括卡尺数量、搜索长度、搜索方向、对比度阈值、是否按分数排列、卡尺结果是否反向排列、边缘极性、滤波器半宽、探测结果偏移量、中心点最强和是否启用；在找任意曲线GUI右键菜单项设置增加卡尺(Add Element)、删除卡尺(Remove Element)、编辑卡尺参数(Edit Param)、保存(Save Param)和导入(Load Param)参数。</p>

<p><img src="media/wps27.JPG" alt="img" /></p>

<p><imgnote>图3 卡尺参数编辑对话框</imgnote></p>

<h2>注意</h2>

<ul>
<li><p>如果需要曲线拟合，需开启曲线拟合选项。</p></li>
<li><p>端点处理只在曲线拟合有效下进行。</p></li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\形状间距及相关点.gvp”。</p>
