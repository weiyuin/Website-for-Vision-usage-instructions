<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>通用高度测量工具</h1>

<h2>功能</h2>

<p>在3D测量中，高度测量工具主要是获取输入点集或深度图像中检测区域内三维空间点到指定基平面的高度距离，并完成高度最小值、最大值、均值、中值等高度信息的统计，帮助用户更加精确的获取高度距离的分布情况。一个三维点（深度图像像素点）到基平面的高度如图1所示。</p>

<p><img src="media/wps30.jpg" alt="img" /></p>

<p><imgnote>图1 三维点到基平面的高度示意图</imgnote></p>

<p>图2所示为高度测量工具示意图。在高度测量工具中，支持单ROI模式和多ROI模式，且可以对高度测量区域的形状和特征等进行配置。如图2所示，总共有三个测量区域，这个两个区域的形状分别为矩形、仿射矩形、圆，且可以分别测量这三个区域内的特征点（如均值、中值等）或者所有数据到基平面的高度值的统计信息。</p>

<p><img src="media/wps31.jpg" alt="img" /></p>

<p><imgnote>图2 高度测量工具示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th> 参数名称             </th>
<th> 参数描述                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td> 深度图像             </td>
<td> 显示待检测的深度图像，显示为伪彩色图像。                     </td>
</tr>
<tr>
<td> 基平面               </td>
<td> 选择高度测量的基准平面。                                     </td>
</tr>
<tr>
<td> 二维线性变换         </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                       </td>
</tr>
<tr>
<td> 模式                 </td>
<td> 分为三种：单ROI模式、多ROI模式、点集模式                     </td>
</tr>
<tr>
<td> 计算取反             </td>
<td> 当选择“是”时，高度计算值符号取反，主要应用于凹槽、厚度等向下计算高度为正的场合。 </td>
</tr>
<tr>
<td> 系数补偿             </td>
<td> 测量结果系数补偿，一般为1，用于补偿成像等系统误差。          </td>
</tr>
<tr>
<td> 固定补偿             </td>
<td> 测量结果固定补偿，一般为0，用于补偿成像等系统误差。          </td>
</tr>
<tr>
<td> 高度最大值上限       </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度最大值下限       </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度最小值上限       </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度最小值下限       </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度均值上限         </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度均值下限         </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度中值上限         </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 高度中值下限         </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 单ROI类型            </td>
<td> 待检测区域，分为7种：整幅图像、矩形、仿射矩形、圆形、圆环、椭圆、多边形。 </td>
</tr>
<tr>
<td> 启用掩膜             </td>
<td> 是否启用掩膜，选择“是”，显示掩膜个数、掩膜序号、掩膜形状等参数。 </td>
</tr>
<tr>
<td> 掩膜个数             </td>
<td> 设置启用的掩膜个数，取值范围为[1, 99]。                      </td>
</tr>
<tr>
<td> 掩膜序号             </td>
<td> 当前欲设置的掩膜索引。                                       </td>
</tr>
<tr>
<td> 掩膜类型             </td>
<td> 当前欲设置的掩膜形状，分为6种：矩形、仿射矩形、圆形、圆环、椭圆、多边形。 </td>
</tr>
<tr>
<td> 低尾部分数           </td>
<td> 计算低尾部的比例参数，取值范围为[0,1]，且高低尾部分数之和小于等于1，参考监视窗口低尾部参数。 </td>
</tr>
<tr>
<td> 高尾部分数           </td>
<td> 计算高尾部的比例参数，取值范围为[0,1]，参考监视窗口低尾部参数，且高低尾部分数之和小于等于1，参考监视窗口高尾部参数。 </td>
</tr>
<tr>
<td> 启用高度范围过滤器   </td>
<td> 选择“是”，则对计算得到的高度数据根据高度范围进行过滤，并显示高度范围下限和高度范围上限参数。 </td>
</tr>
<tr>
<td> 高度范围的下限       </td>
<td> 高度范围的下限，且高度下限应小于等于高度上限，根据高度范围对计算得到的高度数据进行过滤。 </td>
</tr>
<tr>
<td> 高度范围的上限       </td>
<td> 高度范围的上限，且高度下限应小于等于高度上限，根据高度范围对计算得到的高度数据进行过滤。 </td>
</tr>
<tr>
<td> 包含高度范围内的值   </td>
<td> 选择“是”，则包含高度范围内的值，否则为排除高度范围内的值。   </td>
</tr>
<tr>
<td> ROI数量              </td>
<td> 该参数用于指定测量区域的数量，最多支持100个ROI。             </td>
</tr>
<tr>
<td> ROI索引              </td>
<td> 该参数用于选择第i个测量区域，并对其参数进行设置。            </td>
</tr>
<tr>
<td> 多ROI类型            </td>
<td> 待检测区域，分为7种：整幅图像、矩形、仿射矩形、圆形、圆环、椭圆、多边形。 </td>
</tr>
<tr>
<td> 相同属性             </td>
<td> 选择“是”，同步所有ROI的大小、形状、区间上下限、结果区间上下限 </td>
</tr>
<tr>
<td> 测量点特征           </td>
<td> 选取ROI区域内的某种特征点进行高度测量，分为6种：均值、中值、质心、Z最大、Z最小、所有数据。 </td>
</tr>
<tr>
<td> 区间上、下限         </td>
<td> 测量区域的深度数据按照Z分量从小到大排序，然后再获取位于start% ~ end%的深度数据的均值，中值等特征点。取值范围为下限[0,100)，上限(0,100]，且下限小于上限。 </td>
</tr>
<tr>
<td> 结果区间上、下限     </td>
<td> 测量结果的高度值从小到大排序，然后再获取位于start%<br/>~ end%的高度值的均值，中值等特征点。取值范围为下限[0,100)，上限(0,100]，且下限小于上限。 </td>
</tr>
<tr>
<td> 统计结果区间上、下限 </td>
<td> 所有ROI区域测量的高度结果从小到大排序，然后再获取位于start% ~ end%的高度值的均值，中值等特征点，用于整体测量结果的统计输出。取值范围为下限[0,100)，上限(0,100]，且下限小于上限。 </td>
</tr>
<tr>
<td> 统计高度最大值上限   </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度最大值下限   </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度最小值上限   </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度最小值下限   </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度均值上限     </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度均值下限     </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度中值上限     </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
<tr>
<td> 统计高度中值下限     </td>
<td> 取值范围为[-100, 100]，且下限应小于等于上限。                </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th style="text-align:left;"> 参数名称             </th>
<th> 参数描述                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> 深度图像             </td>
<td> 图像的长宽和像素大小，以及深度数据参数。                     </td>
</tr>
<tr>
<td style="text-align:left;"> 均值                 </td>
<td> 高度数据的平均高度值。                                       </td>
</tr>
<tr>
<td style="text-align:left;"> 中值                 </td>
<td> 将高度数据排序后，位于中间位置的高度数据。                   </td>
</tr>
<tr>
<td style="text-align:left;"> 最小值               </td>
<td> 高度数据中最小高度数值。                                     </td>
</tr>
<tr>
<td style="text-align:left;"> 最大值               </td>
<td> 高度数据中最大高度数值。                                     </td>
</tr>
<tr>
<td style="text-align:left;"> 低尾部               </td>
<td> 使得小于某数值的数据量达到指定比例（低尾部分数）的高度数值。 </td>
</tr>
<tr>
<td style="text-align:left;"> 高尾部               </td>
<td> 是的大于某数值的数据量达到指定比例（高尾部分数）的高度数值。 </td>
</tr>
<tr>
<td style="text-align:left;"> 区域边界框内像素数目 </td>
<td> 感兴趣区域的最小外接矩形内像素（包含无效像素）的数目。       </td>
</tr>
<tr>
<td style="text-align:left;"> 关注像素数目         </td>
<td> 感兴趣区域形状内像素（包含无效像素）的数目。                 </td>
</tr>
<tr>
<td style="text-align:left;"> 可见关注像素数目     </td>
<td> 感兴趣区域形状内有效像素的数目。                             </td>
</tr>
<tr>
<td style="text-align:left;"> 所用像素数目         </td>
<td> 感兴趣区域内实际用于高度测量的像素数目。                     </td>
</tr>
<tr>
<td style="text-align:left;"> 高度测量结果         </td>
<td> 显示每个测量区域的高度测量结果，包括每个测量区域内的高度最大值、最小值、均值、中值，以及所有测量区域测量结果的统计结果。 </td>
</tr>
<tr>
<td style="text-align:left;"> 高度最大值           </td>
<td> ROI中高度最大值输出，最后一位为统计结果最大值。                                        </td>
</tr>
<tr>
<td style="text-align:left;"> 高度最小值           </td>
<td> ROI中高度最小值输出，最后一位为统计结果最小值。                                        </td>
</tr>
<tr>
<td style="text-align:left;"> 高度均值             </td>
<td> ROI中高度均值输出，最后一位为统计结果均值。                                          </td>
</tr>
<tr>
<td style="text-align:left;"> 高度中值             </td>
<td> ROI中高度中值输出，最后一位为统计结果中值。                                          </td>
</tr>
<tr>
<td style="text-align:left;"> ROI判定结果          </td>
<td> 各个ROI高度测量值判定结果。                                  </td>
</tr>
<tr>
<td style="text-align:left;"> 执行结果             </td>
<td> 工具执行结果。                                               </td>
</tr>
<tr>
<td style="text-align:left;"> 执行时间             </td>
<td> 工具执行时间。                                               </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>基平面</h3>

<p>基平面的设置其实就是在深度图像上选择一个感兴趣区域以获取三维数据点，然后根据平面方向和拟合方法执行平面拟合。默认情况下，基平面为XOY平面。</p>

<h3>测量区间、结果区间</h3>

<p>设区间范围为[start%, end%]，则只有位于区间范围内的数据才是有效的；如图3(a)所示，当对测量区域进行参数配置时，将区域内的深度数据按照Z分量从小到大进行排序，然后再获取位于start% ~ end%的深度数据的均值，中值等特征点；如图3(b)所示，在高度测量结果中时，将高度值按照从小到大进行排序，然后再获取位于start% ~ end%内的高度值的均值，中值等。</p>

<p><img src="media/wps36.png" alt="img" /></p>

<p><imgnote>图3 测量区间、结果区间示意图</imgnote></p>

<h3>单ROI模式使用向导</h3>

<p><strong>Step 1 设置测量区域及掩膜</strong></p>

<p>为了获取三维空间点数据需要设置测量区域及掩膜，其中，测量区域形状支持圆、椭圆、多边形、矩形、仿射矩形或圆环段等六种设置，掩膜支持任意数量的圆、椭圆、多边形、矩形、仿射矩形和圆环段等六种区域设置；此时，高度测量使用的是测量区域形状内除去掩膜区域的三维空间点数据。</p>

<p><strong>Step 2 设置直方图统计</strong></p>

<p>设置直方图统计主要包括：设置参数与设置高度范围过滤器。设置参数是对低尾部分数、高尾部分数和StdDev系数三个参数进行设置。设置高度范围过滤器主要是对计算得到的高度数据进行过滤，可以指定一个高度范围，并确定高度范围滤波模式是包含高度范围内的值还是排除高度范围内的值。</p>

<p><strong>Step 3 执行测量与输出结果</strong></p>

<p>获取三维空间点数据后，执行测量可以得到高度数据，并完成高度信息的统计，输出高度直方图、最小值、最大值、均值、中值、标准差、低尾部和高尾部等结果，以及像素计数结果。</p>

<p><strong>Step 4 补偿和结果判定</strong></p>

<p>若需要对计算结果进行补偿或者判定的话，可以对系数补偿、固定补偿、判定依据、最大值、最小值进行设置。</p>

<h3>多ROI模式使用向导</h3>

<p><strong>Step 1 测量区域的参数设置</strong></p>

<p>主要需要对测量区域的个数、形状、区域内的特征点类型和区间的范围进行设置。其中，用户可自行指定测量区域的数量；测量区域的形状分为7种：整幅图像、矩形、仿射矩形、圆形、圆环、椭圆、多边形；测量区域内的特征点类型分为6种：均值、中值、质心、Z最大、Z最小、所有数据。</p>

<p><strong>Step 2 高度测量结果的参数设置</strong></p>

<p>接着需要对每一个测量区域的高度测量结果的参数进行设置。需要设置的参数有：区间范围。用户可根据实际的项目需求对这些参数进行设置。</p>

<p><strong>Step 3  执行高度测量和输出结果</strong></p>

<p>在上述步骤之后，就可以执行高度测量。高度测量的输出结果主要包括：每一个测量区域内的高度特征值（最大值，最小值，均值、中值）以及所有测量区域内高度特征值的一个统计结果。</p>

<p><strong>Step 4 补偿和结果判定</strong></p>

<p>若需要对计算结果进行补偿或者判定的话，可以对系数补偿、固定补偿、判定依据、最大值、最小值进行设置。</p>

<h3>点集模式使用向导</h3>

<p><strong>Step 1 设置输入点集合</strong></p>

<p>数据链接输入三维点集或脚本设置数据链的三维点集。</p>

<p><strong>Step 2 设置直方图统计</strong></p>

<p>设置直方图统计主要包括：设置参数与设置高度范围过滤器。设置参数是对低尾部分数、高尾部分数和StdDev系数三个参数进行设置。设置高度范围过滤器主要是对计算得到的高度数据进行过滤，可以指定一个高度范围，并确定高度范围滤波模式是包含高度范围内的值还是排除高度范围内的值。</p>

<p><strong>Step 3 执行测量与输出结果</strong></p>

<p>获取三维空间点数据后，执行测量可以得到高度数据，并完成高度信息的统计，输出高度直方图、最小值、最大值、均值、中值、标准差、低尾部和高尾部等结果，以及像素计数结果。</p>

<p><strong>Step 4 补偿和结果判定</strong></p>

<p>若需要对计算结果进行补偿或者判定的话，可以对系数补偿、固定补偿、判定依据、最大值、最小值进行设置。</p>

<h2>注意</h2>

<ul>
<li>高度测量中使用的基平面需要从其他工具链接（例如平面拟合工具2），若未链接基平面参数，测量过程中将使用默认值，默认基平面为Z=0的平面（即XOY面）。</li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\3D\深度图\通用高度测量工具.gvp”。</p>
