<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>点云位置和尺寸测量工具</h1>

<h2>功能</h2>

<p>在3D测量中，往往需要对深度图像中两个检测区域内深度数据的特征点进行定位，并对这两个特征点之间的尺寸信息进行测量，图1所示为两个检测区域内均值特征点之间的高度距离信息。</p>

<p> <img src="media/wps3.jpg" alt="img" /></p>

<p><imgnote>图1 点云位置和尺寸测量工具示意图</imgnote></p>

<h2>参数</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称       </th>
<th> 参数描述                                                                                                         </th>
</tr>
</thead>
<tbody>
<tr>
<td> 属性窗口       </td>
<td> 位置1 特征点模式                                       </td>
<td> 包括检测和引用两种，可以实时检测或者引用其他工具的特征点作为输入。 </td>
</tr>
<tr>
<td>  </td>
<td> 位置1 ROI生成方式 </td>
<td> 包括：定位、固定ROI、参考点三种模式，参考点模式会根据数据链接中的参考点和参考直线建立产品坐标系。 </td>
</tr>
<tr>
<td>  </td>
<td> X固定偏移量 </td>
<td> 在参考点模式下，在建立的产品坐标系中ROI参考位置坐标X，单位：mm。 </td>
</tr>
<tr>
<td>  </td>
<td> Y固定偏移量 </td>
<td> 在参考点模式下，在建立的产品坐标系中ROI参考位置坐标Y，单位：mm。 </td>
</tr>
<tr>
<td>  </td>
<td> 位置1 ROI类型 </td>
<td> 第1个检测区域，分为3种：整幅图像、矩形、仿射矩形。 </td>
</tr>
<tr>
<td></td>
<td> 位置1 特征类型 </td>
<td> 根据深度数据特征类型获取特征点1三维坐标信息。<img src="media/wps5.jpg" alt="img" />                                                     </td>
</tr>
<tr>
<td></td>
<td> 位置1区间上、下限 </td>
<td> 测量区域的深度数据按照Z分量从小到大排序，然后再获取位于start% ~ end%的深度数据的均值，中值等特征点。取值范围为下限[0,100)，上限(0,100]，且下限小于上限。 </td>
</tr>
<tr>
<td></td>
<td> 位置2 特征点模式 </td>
<td> 包括检测和引用两种，可以实时检测或者引用其他工具的特征点作为输入。 </td>
</tr>
<tr>
<td></td>
<td> 位置2 ROI生成方式 </td>
<td> 包括：定位、固定ROI、参考点三种模式，参考点模式会根据数据链接中的参考点和参考直线建立产品坐标系。 </td>
</tr>
<tr>
<td></td>
<td> X固定偏移量 </td>
<td> 在参考点模式下，在建立的产品坐标系中ROI参考位置坐标X，单位：mm。 </td>
</tr>
<tr>
<td></td>
<td> Y固定偏移量 </td>
<td> 在参考点模式下，在建立的产品坐标系中ROI参考位置坐标Y，单位：mm。 </td>
</tr>
<tr>
<td></td>
<td> 位置2 ROI类型 </td>
<td> 第2个检测区域，分为3种：整幅图像、矩形、仿射矩形。                                                               </td>
</tr>
<tr>
<td></td>
<td> 位置2 特征类型 </td>
<td> 根据深度数据特征类型获取特征点2三维坐标信息。                                                                    </td>
</tr>
<tr>
<td></td>
<td> 尺寸 特征类型  </td>
<td> 深度数据的尺寸类型，以便计算两个特征点的距离或中点，分为6种：宽度、长度、高度、欧氏距离、平面距离、中点。<img src="media/wps6.jpg" alt="img" />                                                     </td>
</tr>
<tr>
<td></td>
<td> 系数补偿 </td>
<td> 测量结果系数补偿，一般为1，用于补偿成像等系统误差。 </td>
</tr>
<tr>
<td></td>
<td> 固定补偿 </td>
<td> 测量结果固定补偿，一般为0，用于补偿成像等系统误差。 </td>
</tr>
<tr>
<td></td>
<td> 阈值范围下限 </td>
<td> 判定条件的下限值，取值范围：[-100000,100000]，单位：mm。 </td>
</tr>
<tr>
<td></td>
<td> 阈值范围上限 </td>
<td> 判定条件的上限值，取值范围：[-100000,100000]，单位：mm。 </td>
</tr>
<tr>
<td> 图像窗口       </td>
<td> 深度图像                                                     </td>
<td> 显示待检测的深度图像，显示为伪彩色图像。           </td>
</tr>
<tr>
<td></td>
<td> 检测区域       </td>
<td> 在图像上显示位置1和位置2的检测区域。                                                                             </td>
</tr>
<tr>
<td> 数据链         </td>
<td> 输入深度图像                                                 </td>
<td> 输入待检测的深度图像。                             </td>
</tr>
<tr>
<td></td>
<td> 二维线性变换   </td>
<td> 目标相对于模板的平移、旋转、缩放变换。                                                                           </td>
</tr>
<tr>
<td></td>
<td> 参考点 </td>
<td> 以此点建立产品坐标系的原点。 </td>
</tr>
<tr>
<td></td>
<td> 参考直线 </td>
<td> 当直线角度趋向于水平时，则该直线作为X轴，否则为Y轴。 </td>
</tr>
<tr>
<td></td>
<td> 像素当量 </td>
<td> 建立产品坐标系时，即属性中的X固定偏移、Y中的固定偏移以此反推出图像距离，单位：mm/pixel。 </td>
</tr>
<tr>
<td>高级界面</td>
<td> 无       </td>
<td> 无                                                                                                               </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th>分类 </th>
<th> 参数名称          </th>
<th> 参数描述                                                                                            </th>
</tr>
</thead>
<tbody>
<tr>
<td> 监视窗口          </td>
<td> 输入深度图像                                          </td>
<td> 输入图像的长宽和像素大小，以及深度数据参数。 </td>
</tr>
<tr>
<td></td>
<td> 位置1             </td>
<td> 第1个检测区域内特征点的三维坐标信息。                                                               </td>
</tr>
<tr>
<td></td>
<td> 位置2             </td>
<td> 第2个检测区域内特征点的三维坐标信息。                                                               </td>
</tr>
<tr>
<td></td>
<td> 尺寸结果          </td>
<td> 两个特征点间的宽度/长度/高度/欧氏距离/平面距离/中点。                                               </td>
</tr>
<tr>
<td></td>
<td> 执行结果          </td>
<td> 工具执行结果。                                                                                      </td>
</tr>
<tr>
<td></td>
<td> 执行时间          </td>
<td> 工具执行时间。                                                                                      </td>
</tr>
<tr>
<td> 图像窗口          </td>
<td> 输入深度图像                                          </td>
<td> 显示检测的深度图像，显示为伪彩色图像。       </td>
</tr>
<tr>
<td></td>
<td> 特征点、距离/中点 </td>
<td> 显示特征点结果，及两个特征点间的距离或中点。                                                        </td>
</tr>
<tr>
<td>数据链</td>
<td>   图像          </td>
<td> 同监视窗口参数，供后续工具使用。                   </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h3>使用向导</h3>

<p><strong>Step 1 设置检测区域和深度数据特征类型</strong></p>

<p>为了获取深度数据中的特征点三维坐标信息，需要设置检测区域和深度数据特征类型。其中，检测区域有3种：整幅图像、矩形，仿射矩形，而深度数据特征类型有9种：均值、中值、质心、X最大、X最小、Y最大、Y最小、Z最大、Z最小。</p>

<p>均值：检测区域内所有深度数据坐标（X,Y,Z）的均值。</p>

<p>中值：检测区域内所有深度数据坐标（X,Y,Z）的中值。</p>

<p>质心：检测区域内所有深度数据坐标（X,Y,Z）的质心。</p>

<p>X最大值：检测区域内所有深度数据坐标（X,Y,Z）中X坐标最大所对应的深度数据的坐标信息。</p>

<p>X最小值：检测区域内所有深度数据坐标（X,Y,Z）中X坐标最小所对应的深度数据的坐标信息。</p>

<p>Y最大值：检测区域内所有深度数据坐标（X,Y,Z）中Y坐标最大所对应的深度数据的坐标信息。</p>

<p>Y最小值：检测区域内所有深度数据坐标（X,Y,Z）中Y坐标最小所对应的深度数据的坐标信息。</p>

<p>Z最大值：检测区域内所有深度数据坐标（X,Y,Z）中Z坐标最大所对应的深度数据的坐标信息。</p>

<p>Z最小值：检测区域内所有深度数据坐标（X,Y,Z）中Z坐标最小所对应的深度数据的坐标信息。</p>

<p><strong>Step 2 设置深度数据尺寸类型</strong></p>

<p>为了获取深度数据特征点之间的距离或者中点坐标信息，需要设置深度数据的尺寸类型。深度数据的尺寸类型有6种：宽度、长度、高度、欧式距离、平面距离、中点，如图2所示。</p>

<p><img src="media/wps9.jpg" alt="img" /></p>

<p><imgnote>图2 位置和尺寸示意图</imgnote></p>

<p><strong>Step 3 执行测量和输出结果</strong></p>

<p>在设置好检测区域，深度数据特征类型以及深度数据尺寸类型之后，就可以执行测量了。输出的结果包括，两个特征点的三维坐标信息，两个特征点之间的尺寸信息或者其中点坐标信息。</p>

<h2>注意</h2>

<p>无</p>

<h2>示例工程</h2>

<p>参见“\Samples\3D\深度图\3D测量工具.gvp”。</p>
