<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>装配标准机台</h1>

<p>在使用本功能前，工程中需要有图像源/图像采集工具，且工具链接相机，本功能通过图像源/图像采集工具调整相机位姿及成像参数。</p>

<p>标准机台装机分为8个步骤，分别为：</p>

<p>Step 1：相机成像参数调整，初步调整成像清晰度；</p>

<p>Step 2：相机位置调整，视野中心，调整产品/靶标中心与图像中心的相对位置；</p>

<p>Step 3：相机白平衡，调整相机白平衡；</p>

<p>Step 4：成像清晰度，通过调整相机参数，调整ROI清晰度和对比度；</p>

<p>Step 5：相机位姿调整，调整相机俯仰角，量化角度，指导用户调整相机位姿；</p>

<p>Step 6：相机白平衡（可选），调整相机白平衡；</p>

<p>Step 7：成像清晰度，通过调整相机参数，调整ROI清晰度和对比度；</p>

<p>Step 8：成像亮度调整，调整光源位姿或亮度；</p>

<p>Step 9：基于白平衡调整产品与背景色差，调整相机白平衡，凸显产品特征。</p>

<h2>1. 操作说明</h2>

<h3>1. 相机成像参数调整</h3>

<p>相机成像参数调整功能，如下图1-1所示：</p>

<p><img src="media/SetupTool0-1_0.png" alt="SetupTool_1_1" /></p>

<div align = "center">图1-1</div>


<p>以下为详细介绍：</p>

<ol>
<li><p>图像采集工具
可以选择工程中的图像源/图像采集工具，用于关联相机，该相机实时图像会显示在右侧图像区域（当前为实时采集图像模式）。</p></li>
<li><p>镜像类型
对原始图像进行镜像操作，分为4种类型，无、水平、垂直和水平垂直。</p></li>
<li><p>旋转角度
逆时针将原始图像旋转一定角度，分为4种角度类型，0度、90度、180度和270度。</p></li>
<li><p>曝光
调整相机曝光参数。</p></li>
<li><p>增益
调整相机增益参数。</p></li>
<li><p>Gamma
调整相机Gamma参数</p></li>
<li><p>停止实时采集
停止实时采集图像。</p></li>
<li><p>实时采集图像
使用当前图像源/图像采集工具关联的相机及成像参数，实时采集图像，并在图像区域实时更新显示。</p></li>
<li><p>光源控制
执行工程中的通信发送工具，用于打开/关闭光源。</p></li>
</ol>


<h3>2. 相机位置调整，视野中心</h3>

<p>相机成像参数调整功能，如下图1-2所示：</p>

<p><img src="media/SetupTool0-1_1.png" alt="SetupTool0-1_1" /></p>

<div align = "center">图1-2</div>


<p>以下为详细介绍：</p>

<ol>
<li>最大允许误差X
设置图像X方向最大误差值。</li>
<li>最大允许误差Y
设置图像X方向最大误差值。</li>
<li>图像中心
图像中心坐标。</li>
<li>视野ROI中心
视野_ROI中心坐标。</li>
<li>执行训练
以视野_ROI区域为训练区域，执行训练，并在训练结束后，实时搜索查找区域（实时采集图形模式）。</li>
<li>图像信息说明
视野_ROI为一个放射矩形，为用户标注的感兴趣区域，可以自由拖动，视野中的“误差”为图像中心与视野ROI中心差值的绝对值，当差值小于设定的“最大允许误差”时，“误差”为绿色字体，否则为红色字体。</li>
</ol>


<h3>3. 相机白平衡</h3>

<p>相机白平衡功能，如下图1-3所示：</p>

<p><img src="media/SetupTool0-1_2.png" alt="SetupTool0-1_2" /></p>

<div align = "center">图1-3</div>


<p>以下为详细介绍：
1.  自动白平衡
设置白平衡的模式，只对LBAS彩色相机有效，取值有Continuous、Once、Off。
2.  白平衡通道
自动白平衡设置为Off时可用，可以选择R、G、B通道。
3.  白平衡比例
对选定白平衡通道值的设置。
4.  自定义阈值
用于计算与期望ROI均值最接近的白平衡比例。。
5.  保存
保存已设置的白平衡比例。
6.  ROI均值列表
用户可增加或减少亮度ROI区域的个数，个数范围为：[0,12]，当相机为灰度相机时，ROI统计均值信息，当相机为彩色相机时，统计ROI区域的R、G、B通道均值信息。</p>

<h3>4. 成像清晰度</h3>

<p>成像清晰度功能，如下图1-4所示：</p>

<p><img src="media/SetupTool0-1_3.png" alt="SetupTool0-1_3" /></p>

<div align = "center">图1-4</div>


<p>以下为详细介绍：
1.  曝光
调整相机曝光参数。
2.  增益
调整相机增益参数。
3.  Gamma
调整相机Gamma参数
4.  清晰度
显示“图像质量评估<em>ROI”区域的清晰度指标。
5.  对比度
显示“图像质量评估</em>ROI”区域的对比度指标。
6.  图像信息说明
“图像质量评估_ROI”I为一个放射矩形，为用户标注的感兴趣区域，可以自由拖动，用于计算清晰度和对比度指标。</p>

<h3>5. 成像清晰度</h3>

<p>相机位姿计算方法有两种，分别为：方形孔和圆形孔。
方法一：方形孔
方形孔通过仿形块的左上、左下、右上和右下四个孔计算相机位姿信息，窗口如图1-5所示：</p>

<p><img src="media/SetupTool0-1_4.png" alt="SetupTool0-1_4" /></p>

<div align = "center">图1-5</div>


<p>以下为详细介绍：
1.  显示外接矩形
用于整体拖动左上、左下、右上和右下的ROI。
2.  显示找线区域
显示每个ROI的4个找线区域。
3.  显示找线结果
显示所有ROI的找线结果。
4.  显示线段结果
显示ROI的线段结果，线段为ROI的上、下、左、右、上内、下内、左内、右内线段。
5.  显示高级信息
显示选定ROI的找线参数信息：
    1)  边缘模式：边缘极性是指图像边缘灰度级的过渡形式，分为3种，任意极性、亮到暗和暗到亮；
    2)  边缘属性：最佳边缘、第一条、最后一条；
    3)  对比度阈值：工具默认只采用对比度评价分数，即按照边缘信号的强度来评分，输出边缘最强的点。对比度阈值的取值范围是0~255；
    4)  局外点比例：局外点就是偏离曲线较远的点。局外点比例即不参与直线拟合的点的比例，取值范围是0~0.5。
6.  执行训练
训练中心ROI区域，训练结束后，实时显示搜索结果（实时采集图像模式）。
方法二：圆形孔
圆形孔通过仿形块的上、下、左和右四个圆形孔计算相机位姿信息，窗口如图1-6所示：</p>

<p><img src="media/SetupTool0-1_5.png" alt="SetupTool0-1_5" /></p>

<div align = "center">图1-6</div>


<p>以下为详细介绍：
1.  显示外接矩形
用于整体拖动上、下、左、右的ROI。
2.  显示找线区域
显示每个ROI的4个找线区域。
3.  显示找线结果
显示所有ROI的找线结果。
4.  显示高级信息
显示选定ROI的找线参数信息：
    1)  边缘模式：边缘极性是指图像边缘灰度级的过渡形式，分为3种，任意极性、亮到暗和暗到亮；
    2)  边缘属性：最佳边缘、第一条、最后一条；
    3)  对比度阈值：工具默认只采用对比度评价分数，即按照边缘信号的强度来评分，输出边缘最强的点。对比度阈值的取值范围是0~255；
    4)  局外点比例：局外点就是偏离曲线较远的点。局外点比例即不参与直线拟合的点的比例，取值范围是0~0.5。
5.  执行训练
训练中心ROI区域，训练结束后，实时显示搜索结果（实时采集图像模式）。</p>

<h3>6. 相机白平衡（可选）</h3>

<p>与1.3功能重复，在调整成像清晰度后，可能需要再次调整相机白平衡，依据项目需要，该步骤为可选项。</p>

<h3>7. 成像清晰度</h3>

<p>与1.4功能重复，在调整相机位姿后，需要再次确认相机成像是否清晰，该步骤不可跳过。</p>

<h3>8. 成像亮度调整</h3>

<p>成像亮度调整功能，如下图1-7所示：</p>

<p><img src="media/SetupTool0-1_7.png" alt="SetupTool0-1_6" /></p>

<div align = "center">图1-7</div>


<p>以下为详细介绍：
1.  ROI均值列表
   用户可增加或减少亮度ROI区域的个数，个数范围为：[0,12]，当相机为灰度相机时，ROI统计均值信息，当相机为彩色相机时，统计ROI区域的R、G、B通道均值信息。
2.  计算像素当量
   计算像素当量参数包括：
   1)   靶标尺寸X：每个靶标格的横向尺寸，单位mm，默认为2mm；
   2)   靶标尺寸Y：每个靶标格的纵向尺寸，单位mm，默认为2mm；
   3)   强度阈值：黑白格的灰度差异程度，提取的角点对应强度要高于该阈值，范围为[1, 255]，默认为16；
   4)   窗口尺寸：推荐设置为一个棋盘格的像数宽度的大小，范围为[1, 500]，默认为3；
   5)   角点清晰度：角点越尖锐清晰值越小，越模糊值越大，范围为[0,1000]，默认为2；
   6)   计算：开始计算靶标像素当量；
   7)   像素当量：像素当量计算结果，当计算失败时，显示“&mdash;&mdash;”。</p>

<h3>9. 基于白平衡调整产品与背景色差</h3>

<p>基于白平衡调整产品与背景色差功能，如下图1-8和1-9所示：</p>

<p><img src="media/SetupTool0-1_8.png" alt="SetupTool0-1_8" /></p>

<div align = "center">图1-8</div>


<p><img src="media/SetupTool0-1_9.png" alt="SetupTool0-1_9" /></p>

<div align = "center">图1-9</div>


<p>以下为详细介绍：</p>

<ol>
<li><p>亮度ROI均值允许最小误差
R通道：ROI_1-产品与ROI_1-背景ROI的R通道允许的最小差值，当实际结果小于允许值时，图像对于的产品ROI的R通道显示为红色字体，否则为绿色字体；</p>

<p>G通道：ROI_1-产品与ROI_1-背景ROI的G通道允许的最小差值，当实际结果小于允许值时，图像对于的产品ROI的G通道显示为红色字体，否则为绿色字体；</p>

<p>B通道：ROI_1-产品与ROI_1-背景ROI的B通道允许的最小差值，当实际结果小于允许值时，图像对于的产品ROI的B通道显示为红色字体，否则为绿色字体。</p></li>
<li><p>亮度ROI对</p>

<p>+按钮：添加一对亮度ROI（ROI_1-产品与ROI_1-背景ROI）；</p>

<p>-按钮：删除列表选中的一对亮度ROI。</p></li>
<li><p>自动模式（图1-8）</p>

<p>勾选R/G/B通道比率，代表该通道白平衡比率参与自动计算；</p>

<p>点击计算按钮，自动计算R/G/B通道白平衡比率，计算使得背景ROI和产品ROI各通道差值绝对值最大的R/G/B通道白平衡比率；</p>

<p>点击取消按钮，取消计算；</p>

<p>点击保存按钮，将当前计算结果保存至相机。</p></li>
<li><p>手动模式（图1-9）</p>

<p>手动调整R/G/B通道比率，实时更新图像，并计算产品和背景ROI内的R/G/B通道的均值，并显示在图像和表格中；</p>

<p>点击保存按钮，将当前计算结果保存至相机。</p></li>
</ol>


<h2>2. 常见问题</h2>

<p>​ 1. 初始进入功能界面时，在确定相机采集参数后，需要点击“实时采集图像”按钮，进行实时采集图像。</p>

<p>​ 2. 如果需要使用“光源控制功能”，需要记录下工程中的通信发送工具名称，执行指定通信发送工具，以便于控制光源。</p>

<p>​ 3. 在“相机位置调整，视野中心”模块中，在执行训练后，会实时在图像中搜索训练图像，当用户拖动图像中的ROI后，停止实时搜索训练图像，在用户重新执行训练后，再次进行实时搜索。</p>

<p>​ 4. 在“相机位姿调整”模块中，需要确定各个ROI区域找线是否准确，如果与预期有偏差，可以展开高级信息，并调整对应的找线参数。</p>

<p>​ 5. 在使用靶标计算像素当量时，需要确定靶标棋盘格的尺寸，并修改对应的参数（靶标尺寸X/Y），否则像素当量计算结果非实际结果。</p>
