<head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../css/main.css" /> 
           <script src="../../js/jquery.js"></script> 
           <script src="../../js/main.js"></script> 
           </head> 
           <head> 
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../css/main.css" /> 
           <script src="../../../js/jquery.js"></script> 
           <script src="../../../js/main.js"></script> 
           </head>  
           <head>  
           <meta charset="utf-8"> 
           <link rel="stylesheet" href="../../../../css/main.css" /> 
           <script src="../../../../js/jquery.js"></script> 
           <script src="../../../../js/main.js"></script> 
           </head>
<h1>轮廓位置尺寸测量工具</h1>

<h2>功能</h2>

<p>在3D测量中，往往需要对轮廓数据中两个检测区域内的特征点进行定位，并对这两个特征点之间的尺寸信息进行测量，图1所示为两个检测区域内Z最大特征点之间的欧式距离信息。</p>

<p><img src="media/GcProfilePositionMeasureTool-1.png" alt="img" style="zoom:75%;" /></p>

<p><imgnote>图1 轮廓位置尺寸测量工具示意图</imgnote></p>

<h2>参数 输入</h2>

<table>
<thead>
<tr>
<th> 参数名称            </th>
<th> 参数描述                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td> 定位跟随            </td>
<td> 是：数据链显示二维线性变换参数；  否：数据链不显示二维线性变换参数； </td>
</tr>
<tr>
<td> 位置1特征点 模式    </td>
<td> 获取位置1的特征点方式，固定值，检测，引用三种                </td>
</tr>
<tr>
<td> 位置1特征点         </td>
<td> 位置1的特征点数值（固定值时显示可修改）                      </td>
</tr>
<tr>
<td> 位置1 ROI类型       </td>
<td> 第1个检测区域，分为3种：整幅图像、矩形、仿射矩形。           </td>
</tr>
<tr>
<td> 位置1 矩形ROI       </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 仿射矩形ROI   </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 特征类型      </td>
<td> 轮廓数据的特征大类型，分为5种：一般特征点、线段特征点、方向特征点、边沿特征点、拐点特征点。 </td>
</tr>
<tr>
<td> 位置1 一般特征      </td>
<td> 特征类型为一般特征点时该参数有效，分为6种：Z最大、Z最小、X最大、X最小、均值、中值。 </td>
</tr>
<tr>
<td> 位置1 线段特征      </td>
<td> 特征类型为线段特征点时该参数有效，分为4种：线段正向、线段反向、左垂直、右垂直。 </td>
</tr>
<tr>
<td> 位置1 方向          </td>
<td> 特征类型为方向特征点时该参数有效，取值范围[-180, 180]，单位：角度。 </td>
</tr>
<tr>
<td> 位置1 边沿特征      </td>
<td> 特征类型为边沿特征点时该参数有效，分为3种：上升沿、下降沿、任意。 </td>
</tr>
<tr>
<td> 位置1 拐点特征      </td>
<td> 特征类型为拐点特征点时该参数有效，分为3种：峰拐点、谷拐点、任意。 </td>
</tr>
<tr>
<td> 位置1 最高点个数    </td>
<td> 当鲁棒性最高点生效时，显示                                   </td>
</tr>
<tr>
<td> 位置1 邻域半径      </td>
<td> 当所有最高点模式生效时，设置搜索点的邻域半径                 </td>
</tr>
<tr>
<td> 位置1 高度阈值      </td>
<td> 当所有最高点模式生效时，设置搜索点的邻域半径内的高度阈值     </td>
</tr>
<tr>
<td> 位置1 搜索模式      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的数量或者比例模式        </td>
</tr>
<tr>
<td> 位置1 搜索个数      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的数量                    </td>
</tr>
<tr>
<td> 位置1 搜索比例      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的比例                    </td>
</tr>
<tr>
<td> 位置1 期望方位      </td>
<td> 统计阈值最高点生效时，期望搜索点位的方向                     </td>
</tr>
<tr>
<td> 位置1 点数阈值      </td>
<td> 统计阈值最高点生效时，邻域半径、高度阈值内定数的阈值         </td>
</tr>
<tr>
<td> 位置1 拟合半径      </td>
<td> 当拟合最高点生效时，设置拟合半径                             </td>
</tr>
<tr>
<td> 位置1 拟合阈值      </td>
<td> 当拟合最高点生效时，设置拟合高度方向的拟合阈值               </td>
</tr>
<tr>
<td> 位置1 重新拟合      </td>
<td> 当拟合最高点生效时，是都对所有的点进行重新拟合               </td>
</tr>
<tr>
<td> 位置1 局外点比例    </td>
<td> 当拟合最高点生效时，设置不参与拟合的比例                     </td>
</tr>
<tr>
<td> 位置1 显示候选点    </td>
<td> 图像中显示出位置1的候选点                                    </td>
</tr>
<tr>
<td> 位置1 锐度阈值类型  </td>
<td> 分为两种：绝对锐度阈值和相对锐度阈值。                       </td>
</tr>
<tr>
<td> 位置1 相对锐度阈值  </td>
<td> 特征类型为拐点特征点时该参数有效，锐度阈值的百分比，即相对锐度阈值=绝对锐度阈值/锐度值最大值。 </td>
</tr>
<tr>
<td> 位置1 绝对锐度阈值  </td>
<td> 特征类型为拐点特征点时该参数有效，待检测拐点锐度值的绝对值需大于锐度阈值，否则该拐点将检测不到。 </td>
</tr>
<tr>
<td> 位置1 方向特征      </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 滤波半宽      </td>
<td> 特征类型为边沿特征点、拐点特征点时该参数有效，用于滤除噪声。 </td>
</tr>
<tr>
<td> 位置1 排序准则      </td>
<td> 特征类型为拐点特征点时该参数有效，分为3种：从左到右、从右到左、幅值，根据所选的准则对检测到的拐点进行排序。 </td>
</tr>
<tr>
<td> 位置1 拐点索引      </td>
<td> 特征类型为拐点特征点时该参数有效，索引设置的范围为[0, CornerNum-1]，CornerNum为有效拐点数量。 </td>
</tr>
<tr>
<td> 位置2 特征点 模式   </td>
<td> 获取位置2的特征点方式，固定值，检测，引用三种                </td>
</tr>
<tr>
<td> 位置2 特征点        </td>
<td> 位置2的特征点数值（固定值时显示可修改）                      </td>
</tr>
<tr>
<td> 位置2 ROI类型       </td>
<td> 第2个检测区域，分为3种：整幅图像、矩形、仿射矩形。           </td>
</tr>
<tr>
<td> 位置2 矩形ROI       </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 仿射矩形ROI   </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 特征类型      </td>
<td> 轮廓数据的特征大类型，分为5种：一般特征点、线段特征点、方向特征点、边沿特征点、拐点特征点。 </td>
</tr>
<tr>
<td> 位置2 一般特征      </td>
<td> 特征类型为一般特征点时该参数有效，分为6种：Z最大、Z最小、X最大、X最小、均值、中值。 </td>
</tr>
<tr>
<td> 位置2 线段特征      </td>
<td> 特征类型为线段特征点时该参数有效，分为4种：线段正向、线段反向、左垂直、右垂直。 </td>
</tr>
<tr>
<td> 位置2 方向          </td>
<td> 特征类型为方向特征点时该参数有效，取值范围[-180, 180]，单位：角度。 </td>
</tr>
<tr>
<td> 位置2 边沿特征      </td>
<td> 特征类型为边沿特征点时该参数有效，分为3种：上升沿、下降沿、任意。 </td>
</tr>
<tr>
<td> 位置2 拐点特征      </td>
<td> 特征类型为拐点特征点时该参数有效，分为3种：峰拐点、谷拐点、任意。 </td>
</tr>
<tr>
<td> 位置2 最高点个数    </td>
<td> 当鲁棒性最高点生效时，显示                                   </td>
</tr>
<tr>
<td> 位置2 邻域半径      </td>
<td> 当所有最高点模式生效时，设置搜索点的邻域半径                 </td>
</tr>
<tr>
<td> 位置2 高度阈值      </td>
<td> 当所有最高点模式生效时，设置搜索点的邻域半径内的高度阈值     </td>
</tr>
<tr>
<td> 位置2 搜索模式      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的数量或者比例模式        </td>
</tr>
<tr>
<td> 位置2 搜索个数      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的数量                    </td>
</tr>
<tr>
<td> 位置2 搜索比例      </td>
<td> 当Z方向稳定最高点生效时，设置搜索点的比例                    </td>
</tr>
<tr>
<td> 位置2 期望方位      </td>
<td> 统计阈值最高点生效时，期望搜索点位的方向                     </td>
</tr>
<tr>
<td> 位置2 点数阈值      </td>
<td> 统计阈值最高点生效时，邻域半径、高度阈值内定数的阈值         </td>
</tr>
<tr>
<td> 位置2 拟合半径      </td>
<td> 当拟合最高点生效时，设置拟合半径                             </td>
</tr>
<tr>
<td> 位置2 拟合高度阈值  </td>
<td> 当拟合最高点生效时，设置拟合高度方向的拟合阈值               </td>
</tr>
<tr>
<td> 位置2 重新拟合      </td>
<td> 当拟合最高点生效时，是都对所有的点进行重新拟合               </td>
</tr>
<tr>
<td> 位置2 局外点比例    </td>
<td> 当拟合最高点生效时，设置不参与拟合的比例                     </td>
</tr>
<tr>
<td> 位置2 显示候选点    </td>
<td> 图像中显示出位置2的候选点                                    </td>
</tr>
<tr>
<td> 位置2 锐度阈值类型  </td>
<td> 分为两种：绝对锐度阈值和相对锐度阈值。                       </td>
</tr>
<tr>
<td> 位置2 相对锐度阈值  </td>
<td> 特征类型为拐点特征点时该参数有效，锐度阈值的百分比，即相对锐度阈值=绝对锐度阈值/锐度值最大值。 </td>
</tr>
<tr>
<td> 位置2 绝对锐度阈值  </td>
<td> 特征类型为拐点特征点时该参数有效，待检测拐点锐度值的绝对值需大于锐度阈值，否则该拐点将检测不到。 </td>
</tr>
<tr>
<td> 位置2 方向特征      </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 滤波半宽      </td>
<td> 特征类型为边沿特征点、拐点特征点时该参数有效，用于滤除噪声。 </td>
</tr>
<tr>
<td> 位置2 排序准则      </td>
<td> 特征类型为拐点特征点时该参数有效，分为3种：从左到右、从右到左、幅值，根据所选的准则对检测到的拐点进行排序。 </td>
</tr>
<tr>
<td> 位置2 拐点索引      </td>
<td> 特征类型为拐点特征点时该参数有效，索引设置的范围为[0, CornerNum-1]，CornerNum为有效拐点数量。 </td>
</tr>
<tr>
<td> 尺寸特征类型        </td>
<td> 轮廓数据的尺寸类型，以便计算两个特征点的距离或中点，分为4种：宽度、高度、欧氏距离、中点。 </td>
</tr>
<tr>
<td> 补偿系数            </td>
<td> 对结果数值进行比例补偿                                       </td>
</tr>
<tr>
<td> 固定补偿            </td>
<td> 对结果数值进行一个固定数值的补偿                             </td>
</tr>
<tr>
<td> 判定条件            </td>
<td> 输入对尺寸结果、中点位置的判定条件                           </td>
</tr>
<tr>
<td> 输入轮廓数据        </td>
<td> 显示待检测的轮廓图像。                                       </td>
</tr>
<tr>
<td> 位置1 特征点GUI     </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 候选点GUI     </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 拟合抛物线GUI </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置1 线段模式GUI   </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 特征点GUI     </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 候选点GUI     </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 拟合抛物线GUI </td>
<td>                                                              </td>
</tr>
<tr>
<td> 位置2 线段模式GUI   </td>
<td>                                                              </td>
</tr>
<tr>
<td> 输入轮廓数据        </td>
<td> 获取待检测的轮廓图像。                                       </td>
</tr>
<tr>
<td> 输入二维线性变换    </td>
<td> 用于进行定位跟随                                             </td>
</tr>
</tbody>
</table>


<h2>输出</h2>

<table>
<thead>
<tr>
<th style="text-align:left;"> 参数名称     </th>
<th> 参数描述                                                     </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> 输入轮廓数据 </td>
<td> 输入待检测的轮廓图像的轮廓数据，包括轮廓点数，有效点数、X方向和Z方向的最大值和最小值，以及反映图像空间和物理空间映射关系的二维线性变换。 </td>
</tr>
<tr>
<td style="text-align:left;"> 位置1        </td>
<td> 第1个检测区域内特征点的二维坐标信息。                        </td>
</tr>
<tr>
<td style="text-align:left;"> 位置2        </td>
<td> 第2个检测区域内特征点的二维坐标信息。                        </td>
</tr>
<tr>
<td style="text-align:left;"> 尺寸结果     </td>
<td> 两个特征点间的宽度/高度/欧氏距离/中点。                      </td>
</tr>
<tr>
<td style="text-align:left;"> 执行结果     </td>
<td> 工具执行结果。                                               </td>
</tr>
<tr>
<td style="text-align:left;"> 执行时间     </td>
<td> 工具执行时间。                                               </td>
</tr>
</tbody>
</table>


<h2>详细说明</h2>

<h4>轮廓位置尺寸测量工具主要分为以下四个步骤</h4>

<p><strong>Step 1</strong> 设置位置1特征点模式，选择“引用”，需要用数据链连接二维坐标；选择“检测”，需要执行<strong>Step 2-3</strong>步骤；选择“固定值”，通过GUI或者编辑框设置固定点；</p>

<p><strong>Step 2</strong> 位置1设置检测区域和轮廓数据特征大类型：为了获取轮廓数据特征点的二维坐标信息，需要设置检测区域和轮廓数据的特征大类型。其中，检测区域分为3种：整幅图像、矩形和仿射矩形，而轮廓数据的大特征类型分为5种：一般特征点，线段特征点，方向特征点，边沿特征点和拐点特征点。</p>

<p><strong>Step 3 </strong>设置轮廓数据的具体特征类型及参数：根据Step1设置的特征大类型，需对不同特征大类型下的具体特征类型及其相关的参数进行设定。</p>

<ul>
<li><p>特征大类型为一般特征点时，需要对一般特征点的具体特征类型进行设置。其中，具体特征类型分为6种：Z最大、Z最小、X最大、X最小、均值、中值、。</p>

<ul>
<li><p>Z最大值：检测区域内所有轮廓数据（X,Z）中Z坐标最大所对应的轮廓数据的坐标信息。</p></li>
<li><p>Z最小值：检测区域内所有轮廓数据（X,Z）中Z坐标最小所对应的轮廓数据的坐标信息。</p></li>
<li><p>X最大值：检测区域内所有轮廓数据（X,Z）中X坐标最大所对应的轮廓数据的坐标信息。</p></li>
<li><p>X最小值：检测区域内所有轮廓数据（X,Z）中X坐标最小所对应的轮廓数据的坐标信息。</p></li>
<li><p>均值：检测区域内所有轮廓数据（X,Z）的均值。</p></li>
<li><p>中值：检测区域内所有轮廓数据（X,Z）的中值。</p></li>
<li>鲁棒性最高点：检测区域内所有轮廓数据（X,Z）的鲁棒性最高点。</li>
<li>稳定性最高点：检测区域内所有轮廓数据（X,Z）的稳定性最高点。</li>
<li>Z方向稳定最高点：检测区域内所有轮廓数据（X,Z）的Z方向的稳定性最高点。</li>
<li>统计阈值最高点：检测区域内所有轮廓数据（X,Z）的统计阈值最高点。</li>
<li>拟合最高点：检测区域内所有轮廓数据（X,Z）的拟合最高点。</li>
</ul>
</li>
<li><p>特征大类型为线段特征点时，需要对线段特征点的具体特征类型以及线段参数进行设置。其中，线段特征点的具体特征类型分为4种：线段正向、线段反向、左垂直、右垂直。而线段参数的设置是通过Edit视图中的线段ROI来进行的。</p></li>
<li><p><img src="media/GcProfilePositionMeasureTool-2.png" alt="img" /></p>

<p><imgnote>图2 线段特征点示意图</imgnote></p>

<ul>
<li>线段正向：设参考线段的角度为<em>θ</em>，将坐标系<em>oxy</em>逆时针旋转<em>θ</em>形成新的坐标系<em>ox’y’</em>。线段正向特征点的定义为：将检测区域内的轮廓数据从坐标系<em>oxy</em>变换到坐标系<em>ox’y’</em>中，并选择在坐标系<em>ox’y’</em>中X值最大所对应的轮廓数据作为线段正向特征点。具体的效果如图2(a)中的实心红点所示。</li>
<li>线段反向：设参考线段的角度为<em>θ</em>，将坐标系<em>oxy</em>逆时针旋转<em>θ</em>形成新的坐标系<em>ox’y’</em>。线段反向特征点的定义为：将检测区域内的轮廓数据从坐标系<em>oxy</em>变换到坐标系<em>ox’y’</em>中，并选择在坐标系<em>ox’y’</em>中X值最小所对应的轮廓数据作为线段反向特征点。具体的效果如图2(b)中的实心红点所示。</li>
<li>左垂直：设参考线段的角度为<em>θ</em>，将坐标系<em>oxy</em>逆时针旋转<em>θ</em>形成新的坐标系<em>ox’y’</em>。左垂直特征点的定义为：将检测区域内的轮廓数据从坐标系<em>oxy</em>变换到坐标系<em>ox’y’</em>中，并选择在坐标系<em>ox’y’</em>中Z值最大所对应的轮廓数据作为左垂直特征点。具体的效果如图2&copy;中的实心红点所示。</li>
<li>右垂直：设参考线段的角度为<em>θ</em>，将坐标系<em>oxy</em>逆时针旋转<em>θ</em>形成新的坐标系<em>ox’y’</em>。右垂直特征点的定义为：将检测区域内的轮廓数据从坐标系<em>oxy</em>变换到坐标系<em>ox’y’</em>中，并选择在坐标系<em>ox’y’</em>中Z值最小所对应的轮廓数据作为右垂直特征点。具体的效果如图2(d)中的实心红点所示。</li>
</ul>
</li>
<li><p>特征大类型为方向特征点时，需要对方向信息进行设置。方向信息采用角度方式进行输入。</p></li>
<li><p><img src="media/GcProfilePositionMeasureTool-3.png" alt="img" /></p>

<p><imgnote>图3 方向特征点示意图</imgnote></p>

<ul>
<li>方向：给定角度<em>θ</em>，计算检测区域内所有轮廓数据的特征值<em>x<strong>·</strong>cos**θ+z·sinθ</em>。然后将特征值最大所对应的轮廓数据作为方向特征点，如图3中的实心红点所示。</li>
</ul>
</li>
<li><p>特征大类型为边沿特征点时，需要对边沿特征点的具体类型、相对锐度阈值进行设置。其中，边沿特征点的具体类型分为3种：上升沿、下降沿、任意。相对锐度阈值设置参考拐点特征点的相对锐度阈值。</p></li>
<li><p><img src="media/GcProfilePositionMeasureTool-4.png" alt="img" /></p>

<p><imgnote>图4 边沿特征点示意图</imgnote></p>

<ul>
<li><p>上升沿：检测区域内所有轮廓数据的上升边缘中二阶微分为0的点，如图4(a)中的空心红点所示。</p></li>
<li><p>下降沿：检测区域内所有轮廓数据的下降边缘中二阶微分为0的点，如图4(b)中的空心红点所示。</p></li>
<li><p>任意沿：检测区域内所有轮廓数据的上升沿或者下降沿特征点。</p></li>
</ul>
</li>
<li><p>特征大类型为拐点特征点时，需要对拐点特征点的具体类型、相对锐度阈值和索引进行设置。其中拐点特征点的具体类型分为3种：峰拐点、谷拐点、任意；索引设置的范围为[0, CornerNum-1]，CornerNum为有效拐点数量。锐度阈值设置的基本原则为：待检测拐点锐度值的绝对值需大于锐度阈值，否则该拐点将检测不到。</p>

<p><img src="media/GcProfilePositionMeasureTool-5.png" alt="img" /></p>

<p><imgnote>图5 拐点特征点示意图</imgnote></p>

<ul>
<li><p>拐点：检测区域内所有轮廓数据中斜率发生改变的点，如图5(a)中的实心红点所示。</p></li>
<li><p>峰拐点：检测区域内所有轮廓数据的所有拐点中向上凸的拐点，如图5(b)中的实心红点所示。</p></li>
<li><p>谷拐点：检测区域内所有轮廓数据的所有拐点中向下凹的拐点，如图5&copy;中的实心红点所示。</p></li>
</ul>
</li>
</ul>


<p><strong>Step 4</strong> 设置位置2特征点模式，选择“引用”，需要用数据链连接二维坐标；选择“检测”，需要执行<strong>Step 2-3</strong>步骤；选择“固定值”，通过GUI或者编辑框设置固定点；</p>

<p><strong>Step 5</strong> 设置轮廓数据尺寸类型：为了获取轮廓数据特征点之间的距离或者中点坐标信息，需要设置轮廓数据的尺寸类型。轮廓数据的尺寸类型分为4种：宽度、高度、欧氏距离、中点。</p>

<p><strong>Step 6</strong> 执行测量和输出结果：在设置好检测区域，轮廓数据特征大类型，具体特征类型及参数，和轮廓数据尺寸类型之后，就可以执行测量了。输出的结果包括，两个特征点的二维坐标信息，两个特征点之间的尺寸信息或者其中点坐标信息。</p>

<h2>注意</h2>

<ul>
<li>尺寸测量项目中，如果选择位置特征点模式为“引用”时，需要通过数据链连接二维坐标点。</li>
</ul>


<h2>示例工程</h2>

<p>参见“\Samples\3D\深度图\轮廓位置尺寸测量工具.gvp”。</p>
